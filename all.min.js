"use strict";var deevee=angular.module("deeVee",[]);deevee.controller("stageCtrl",["$scope","$http",function(t,a){a.get("parts/parts.json").success(function(a){t.parts=a,t.hideCats()}),t.multiplier=1,t.incrementMultiplier=function(){t.multiplier>4?t.multiplier=1:t.multiplier++},t.isPartDialogOpen=function(){return t.partDialog?"partDialogOpen":""},t.catSelected=function(a){return t.parts[a].visible?"selected":""},t.hideCats=function(){for(var a=0;a<t.parts.length;a++)t.parts[a].visible=!1},t.toggleCat=function(a){t.hideCats(),t.parts[a].visible=!t.parts[a].visible},t.partDialog=!1,t.currentStage=!1,t.openPartDialog=function(a){t.currentStage=a,t.partDialog=!0},t.closePartDialog=function(){t.partDialog=!1,t.currentStage=!1},t.savePartDialog=function(a,s){t.addStagePart(a,s,t.multiplier),t.closePartDialog()},t.gravity=9.81,t.totals={totaldv:0,totalmass:0,totalparts:0},t.checkProperty=function(t,a){return"number"==typeof t[a]?t[a]:0},t.stageList=[],t.addStage=function(){t.stageList.push(t.newStage()),t.updateTotals()},t.removeStage=function(a){t.stageList.splice(a,1),t.stageList.length>0&&t.updateCalculations(a),t.updateTotals()},t.addStagePart=function(a,s,e){for(var r=0;e>r;r++)console.log("adding: "+s),t.stageList[a].addPart(s);t.updateCalculations(a),t.updateTotals()},t.removeStagePart=function(a,s){t.stageList[a].removePart(s),t.updateCalculations(a),t.updateTotals()},t.updateCalculations=function(a){if(0===a)t.stageList[a].result=t.stageList[a].calculate(0),t.stageList.length>0&&t.updateCalculations(1);else for(var s=a;s<t.stageList.length;s++){var e=t.stageList[s-1].result.sumwetmass;t.stageList[s].result=t.stageList[s].calculate(e)}},t.updateTotals=function(){var a,s,e;a=s=e=0;for(var r=0;r<t.stageList.length;r++)s+=t.stageList[r].result.dv,e+=t.stageList[r].partsList.length,r===t.stageList.length-1&&(a=t.stageList[r].result.sumwetmass);t.totals={totaldv:s,totalmass:a,totalparts:e}},t.newStage=function(){var a={};return a.atm=!0,a.partsList=[],a.result={impulse:0,thrustratio:0,dv:0,sumwetmass:0},a.removePart=function(t){var s=t>-1&&"undefined"!=typeof a.partsList[t];s&&a.partsList.splice(t,1),a.result=a.calculate(0)},a.addPart=function(s){for(var e={name:s.name,wetmass:s.wetmass,drymass:s.drymass},r=["impulseatm","impulsevac","thrustatm","thrustvac"],i=0;i<r.length;i++)e[r[i]]=t.checkProperty(s,r[i]);a.partsList.push(e)},a.calculate=function(s){var e,r,i,l,u,n,o;e=r=i=l=o=0,n=u=s;for(var p=0;p<a.partsList.length;p++){n+=a.partsList[p].drymass,u+=a.partsList[p].wetmass;var c,g;a.atm?(c=a.partsList[p].impulseatm,g=a.partsList[p].thrustatm):(c=a.partsList[p].impulsevac,g=a.partsList[p].thrustvac),0!==c&&(e+=g,r+=g/c)}return 0!==r&&(i=e/r),0!==n&&(l=Math.log(u/n)*t.gravity*i),0!==u&&(o=e/(u*t.gravity)),{impulse:i,thrustratio:o,dv:l,sumwetmass:u}},a}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJkZWV2ZWUiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29udHJvbGxlciIsIiRzY29wZSIsIiRodHRwIiwiZ2V0Iiwic3VjY2VzcyIsImRhdGEiLCJwYXJ0cyIsImhpZGVDYXRzIiwibXVsdGlwbGllciIsImluY3JlbWVudE11bHRpcGxpZXIiLCJpc1BhcnREaWFsb2dPcGVuIiwicGFydERpYWxvZyIsImNhdFNlbGVjdGVkIiwiaW5kZXgiLCJ2aXNpYmxlIiwiaSIsImxlbmd0aCIsInRvZ2dsZUNhdCIsImNhdEluZGV4IiwiY3VycmVudFN0YWdlIiwib3BlblBhcnREaWFsb2ciLCJzdGFnZUluZGV4IiwiY2xvc2VQYXJ0RGlhbG9nIiwic2F2ZVBhcnREaWFsb2ciLCJwYXJ0IiwiYWRkU3RhZ2VQYXJ0IiwiZ3Jhdml0eSIsInRvdGFscyIsInRvdGFsZHYiLCJ0b3RhbG1hc3MiLCJ0b3RhbHBhcnRzIiwiY2hlY2tQcm9wZXJ0eSIsInByb3BlcnR5Iiwic3RhZ2VMaXN0IiwiYWRkU3RhZ2UiLCJwdXNoIiwibmV3U3RhZ2UiLCJ1cGRhdGVUb3RhbHMiLCJyZW1vdmVTdGFnZSIsInNwbGljZSIsInVwZGF0ZUNhbGN1bGF0aW9ucyIsImNvbnNvbGUiLCJsb2ciLCJhZGRQYXJ0IiwicmVtb3ZlU3RhZ2VQYXJ0IiwicGFydGlkIiwicmVtb3ZlUGFydCIsInJlc3VsdCIsImNhbGN1bGF0ZSIsInByZXZSZXN1bHQiLCJ0b3RhbE1hc3MiLCJ0b3RhbFBhcnRzIiwiZHYiLCJwYXJ0c0xpc3QiLCJzdW13ZXRtYXNzIiwic3RhZ2UiLCJhdG0iLCJpbXB1bHNlIiwidGhydXN0cmF0aW8iLCJwYXJ0RXhpc3RzIiwibmV3cGFydCIsIm5hbWUiLCJ3ZXRtYXNzIiwiZHJ5bWFzcyIsInByb3BlcnRpZXMiLCJwYXlsb2FkTWFzcyIsInN1bXRocnVzdCIsInN1bWZ1ZWx1c2VkIiwidG90YWxpbXB1bHNlIiwic3VtZHJ5bWFzcyIsInRocnVzdCIsImltcHVs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Q3ZCLEdBQUlDLEdBQVdDLEVBQWFDLEVBQWNoQixFQUFJRSxFQUMxQ2UsRUFBWVgsQ0FDaEJRLEdBQVlDLEVBQWNDLEVBQWVoQixFQUFLTSxFQUFjLEVBRTVEVyxFQUFhZixFQUFhVyxDQUUxQixLQUFLLEdBQUlsRCxHQUFJLEVBQUdBLEVBQUl3QyxFQUFNRixVQUFVckMsT0FBUUQsSUFBSyxDQUM3Q3NELEdBQWNkLEVBQU1GLFVBQVV0QyxHQUFHZ0QsUUFDakNULEdBQWNDLEVBQU1GLFVBQVV0QyxHQUFHK0MsT0FDakMsSUFBSUwsR0FBU2EsQ0FDVGYsR0FBTUMsS0FDTkMsRUFBVUYsRUFBTUYsVUFBVXRDLEdBQUd3RCxXQUM3QkQsRUFBU2YsRUFBTUYsVUFBVXRDLEdBQUd5RCxZQUU1QmYsRUFBVUYsRUFBTUYsVUFBVXRDLEdBQUcwRCxXQUM3QkgsRUFBU2YsRUFBTUYsVUFBVXRDLEdBQUcyRCxXQUVoQixJQUFaakIsSUFDQVMsR0FBYUksRUFDYkgsR0FBZUcsRUFBU2IsR0FhaEMsTUFWb0IsS0FBaEJVLElBQ0FDLEVBQWVGLEVBQVlDLEdBRVosSUFBZkUsSUFDQWpCLEVBQUt1QixLQUFLakMsSUFBSVksRUFBYWUsR0FDcEJwRSxFQUFPeUIsUUFBVTBDLEdBRVQsSUFBZmQsSUFDQUksRUFBY1EsR0FBYVosRUFBYXJELEVBQU95QixXQUUzQytCLFFBQVlXLEVBQ1pWLFlBQWdCQSxFQUNoQk4sR0FBT0EsRUFDUEUsV0FBZUEsSUFFcEJDIiwiZmlsZSI6ImFsbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbnZhciBkZWV2ZWUgPSBhbmd1bGFyLm1vZHVsZSgnZGVlVmVlJywgW10pO1xuXG5kZWV2ZWUuY29udHJvbGxlcignc3RhZ2VDdHJsJywgWyckc2NvcGUnLCAnJGh0dHAnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwKSB7XG4gICAgJGh0dHAuZ2V0KCdwYXJ0cy9wYXJ0cy5qc29uJykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAkc2NvcGUucGFydHMgPSBkYXRhO1xuICAgICAgJHNjb3BlLmhpZGVDYXRzKCk7XG4gICAgfSk7XG4gICAgJHNjb3BlLm11bHRpcGxpZXIgPSAxO1xuICAgICRzY29wZS5pbmNyZW1lbnRNdWx0aXBsaWVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICgkc2NvcGUubXVsdGlwbGllciA+IDQpIHtcbiAgICAgICAgICAgICRzY29wZS5tdWx0aXBsaWVyID0gMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICRzY29wZS5tdWx0aXBsaWVyKys7XG4gICAgICAgIH1cbiAgICB9XG4gICAgJHNjb3BlLmlzUGFydERpYWxvZ09wZW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuICRzY29wZS5wYXJ0RGlhbG9nID8gJ3BhcnREaWFsb2dPcGVuJyA6ICcnO1xuICAgIH1cbiAgICAkc2NvcGUuY2F0U2VsZWN0ZWQgPSBmdW5jdGlvbihpbmRleCkge1xuICAgICAgICByZXR1cm4gJHNjb3BlLnBhcnRzW2luZGV4XS52aXNpYmxlID8gJ3NlbGVjdGVkJyA6ICcnO1xuICAgIH1cbiAgICAkc2NvcGUuaGlkZUNhdHMgPSBmdW5jdGlvbigpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgJHNjb3BlLnBhcnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgJHNjb3BlLnBhcnRzW2ldLnZpc2libGUgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgJHNjb3BlLnRvZ2dsZUNhdCA9IGZ1bmN0aW9uKGNhdEluZGV4KSB7XG4gICAgICAgICRzY29wZS5oaWRlQ2F0cygpO1xuICAgICAgICAkc2NvcGUucGFydHNbY2F0SW5kZXhdLnZpc2libGUgPSAhJHNjb3BlLnBhcnRzW2NhdEluZGV4XS52aXNpYmxlO1xuICAgIH1cbiAgICAkc2NvcGUucGFydERpYWxvZyA9IGZhbHNlO1xuICAgICRzY29wZS5jdXJyZW50U3RhZ2UgPSBmYWxzZTtcbiAgICAkc2NvcGUub3BlblBhcnREaWFsb2cgPSBmdW5jdGlvbihzdGFnZUluZGV4KSB7XG4gICAgICAgICRzY29wZS5jdXJyZW50U3RhZ2UgPSBzdGFnZUluZGV4O1xuICAgICAgICAkc2NvcGUucGFydERpYWxvZyA9IHRydWU7XG4gICAgfVxuICAgICRzY29wZS5jbG9zZVBhcnREaWFsb2cgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgJHNjb3BlLnBhcnREaWFsb2cgPSBmYWxzZTtcbiAgICAgICAgJHNjb3BlLmN1cnJlbnRTdGFnZSA9IGZhbHNlO1xuICAgIH1cbiAgICAkc2NvcGUuc2F2ZVBhcnREaWFsb2cgPSBmdW5jdGlvbihzdGFnZUluZGV4LCBwYXJ0KSB7XG4gICAgICAgICRzY29wZS5hZGRTdGFnZVBhcnQoc3RhZ2VJbmRleCwgcGFydCwgJHNjb3BlLm11bHRpcGxpZXIpO1xuICAgICAgICAkc2NvcGUuY2xvc2VQYXJ0RGlhbG9nKCk7XG4gICAgfVxuICAgICRzY29wZS5ncmF2aXR5ID0gOS44MTtcbiAgICAkc2NvcGUudG90YWxzID0geyd0b3RhbGR2JyAgIDogMCxcbiAgICAgICAgICAgICAgICAgICAgICd0b3RhbG1hc3MnIDogMCxcbiAgICAgICAgICAgICAgICAgICAgICd0b3RhbHBhcnRzJzogMH07XG4gICAgJHNjb3BlLmNoZWNrUHJvcGVydHkgPSBmdW5jdGlvbihwYXJ0LCBwcm9wZXJ0eSkge1xuICAgICAgICAvLyBJZiBhIHBhcnQgZG9lc24ndCBoYXZlIGFuIGltcHVsc2Ugb3IgdGhydXN0IHZhbHVlLCBhc3N1bWUgemVyby5cbiAgICAgICAgaWYgKHR5cGVvZiBwYXJ0W3Byb3BlcnR5XSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHJldHVybiBwYXJ0W3Byb3BlcnR5XTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgfVxuICAgICRzY29wZS5zdGFnZUxpc3QgPSBbXTtcbiAgICAkc2NvcGUuYWRkU3RhZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgJHNjb3BlLnN0YWdlTGlzdC5wdXNoKCRzY29wZS5uZXdTdGFnZSgpKTtcbiAgICAgICAgJHNjb3BlLnVwZGF0ZVRvdGFscygpO1xuICAgIH1cbiAgICAkc2NvcGUucmVtb3ZlU3RhZ2UgPSBmdW5jdGlvbihzdGFnZUluZGV4KSB7XG4gICAgICAgICRzY29wZS5zdGFnZUxpc3Quc3BsaWNlKHN0YWdlSW5kZXgsIDEpO1xuICAgICAgICBpZiAoJHNjb3BlLnN0YWdlTGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAkc2NvcGUudXBkYXRlQ2FsY3VsYXRpb25zKHN0YWdlSW5kZXgpO1xuICAgICAgICB9XG4gICAgICAgICRzY29wZS51cGRhdGVUb3RhbHMoKTtcbiAgICB9XG4gICAgJHNjb3BlLmFkZFN0YWdlUGFydCA9IGZ1bmN0aW9uKHN0YWdlSW5kZXgsIHBhcnQsIG11bHRpcGxpZXIpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtdWx0aXBsaWVyOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhZGRpbmc6ICcrcGFydCk7XG4gICAgICAgICAgICAkc2NvcGUuc3RhZ2VMaXN0W3N0YWdlSW5kZXhdLmFkZFBhcnQocGFydCk7XG4gICAgICAgIH1cbiAgICAgICAgJHNjb3BlLnVwZGF0ZUNhbGN1bGF0aW9ucyhzdGFnZUluZGV4KTtcbiAgICAgICAgJHNjb3BlLnVwZGF0ZVRvdGFscygpO1xuICAgIH1cbiAgICAkc2NvcGUucmVtb3ZlU3RhZ2VQYXJ0ID0gZnVuY3Rpb24oc3RhZ2VJbmRleCwgcGFydGlkKSB7XG4gICAgICAgICRzY29wZS5zdGFnZUxpc3Rbc3RhZ2VJbmRleF0ucmVtb3ZlUGFydChwYXJ0aWQpO1xuICAgICAgICAkc2NvcGUudXBkYXRlQ2FsY3VsYXRpb25zKHN0YWdlSW5kZXgpO1xuICAgICAgICAkc2NvcGUudXBkYXRlVG90YWxzKCk7XG4gICAgfVxuICAgICRzY29wZS51cGRhdGVDYWxjdWxhdGlvbnMgPSBmdW5jdGlvbihzdGFnZUluZGV4KSB7XG4gICAgICAgIC8vIFRoZSB1cHBlcm1vc3Qgc3RhZ2UgaGFzIG5vIHBheWxvYWQgdG8gZmFjdG9yIGluLlxuICAgICAgICBpZiAoc3RhZ2VJbmRleCA9PT0gMCkge1xuICAgICAgICAgICAgJHNjb3BlLnN0YWdlTGlzdFtzdGFnZUluZGV4XS5yZXN1bHQgPVxuICAgICAgICAgICAgICAgICRzY29wZS5zdGFnZUxpc3Rbc3RhZ2VJbmRleF0uY2FsY3VsYXRlKDApO1xuICAgICAgICAgICAgaWYgKCRzY29wZS5zdGFnZUxpc3QubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICRzY29wZS51cGRhdGVDYWxjdWxhdGlvbnMoMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBSZWNhbGN1bGF0ZSBhbGwgc3RhZ2VzIGJlbG93IHRoaXMgb25lIGFzIHdlbGwuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gc3RhZ2VJbmRleDsgaSA8ICRzY29wZS5zdGFnZUxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgcHJldlJlc3VsdCA9ICRzY29wZS5zdGFnZUxpc3RbaSAtIDFdLnJlc3VsdFsnc3Vtd2V0bWFzcyddO1xuICAgICAgICAgICAgICAgICRzY29wZS5zdGFnZUxpc3RbaV0ucmVzdWx0ID1cbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnN0YWdlTGlzdFtpXS5jYWxjdWxhdGUocHJldlJlc3VsdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgJHNjb3BlLnVwZGF0ZVRvdGFscyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgdG90YWxNYXNzLCB0b3RhbGR2LCB0b3RhbFBhcnRzO1xuICAgICAgICB0b3RhbE1hc3MgPSB0b3RhbGR2ID0gdG90YWxQYXJ0cyA9IDA7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgJHNjb3BlLnN0YWdlTGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdG90YWxkdiArPSAkc2NvcGUuc3RhZ2VMaXN0W2ldLnJlc3VsdC5kdjtcbiAgICAgICAgICAgIHRvdGFsUGFydHMgKz0gJHNjb3BlLnN0YWdlTGlzdFtpXS5wYXJ0c0xpc3QubGVuZ3RoO1xuICAgICAgICAgICAgLy8gVXNlIHRoZSB2YWx1ZSBvZiB0aGUgbGFzdCBzdGFnZSwgYXMgc3Vtd2V0bWFzcyBpcyBjdW11bGF0aXZlLlxuICAgICAgICAgICAgaWYgKGkgPT09ICRzY29wZS5zdGFnZUxpc3QubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgIHRvdGFsTWFzcyA9ICRzY29wZS5zdGFnZUxpc3RbaV0ucmVzdWx0LnN1bXdldG1hc3M7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAkc2NvcGUudG90YWxzID0geyd0b3RhbGR2JyAgIDogdG90YWxkdixcbiAgICAgICAgICAgICAgICAgICAgICAgICAndG90YWxtYXNzJyA6IHRvdGFsTWFzcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAndG90YWxwYXJ0cyc6IHRvdGFsUGFydHN9O1xuICAgIH1cbiAgICAkc2NvcGUubmV3U3RhZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHN0YWdlID0ge307XG4gICAgICAgIHN0YWdlLmF0bSA9IHRydWU7XG4gICAgICAgIHN0YWdlLnBhcnRzTGlzdCA9IFtdO1xuICAgICAgICBzdGFnZS5yZXN1bHQgPSB7J2ltcHVsc2UnIDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICd0aHJ1c3RyYXRpbycgOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2R2JyA6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAnc3Vtd2V0bWFzcycgOiAwfTtcbiAgICAgICAgc3RhZ2UucmVtb3ZlUGFydCA9IGZ1bmN0aW9uKHBhcnRpZCkge1xuICAgICAgICAgICAgdmFyIHBhcnRFeGlzdHMgPSBwYXJ0aWQgPiAtMVxuICAgICAgICAgICAgICAgICYmIHR5cGVvZiBzdGFnZS5wYXJ0c0xpc3RbcGFydGlkXSAhPT0gJ3VuZGVmaW5lZCc7XG4gICAgICAgICAgICBpZiAocGFydEV4aXN0cykge1xuICAgICAgICAgICAgICAgc3RhZ2UucGFydHNMaXN0LnNwbGljZShwYXJ0aWQsIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3RhZ2UucmVzdWx0ID0gc3RhZ2UuY2FsY3VsYXRlKDApO1xuICAgICAgICB9XG4gICAgICAgIHN0YWdlLmFkZFBhcnQgPSBmdW5jdGlvbihwYXJ0KSB7XG4gICAgICAgICAgICB2YXIgbmV3cGFydCA9IHsnbmFtZScgOiBwYXJ0Lm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAnd2V0bWFzcycgOiBwYXJ0LndldG1hc3MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAnZHJ5bWFzcycgOiBwYXJ0LmRyeW1hc3N9O1xuICAgICAgICAgICAgdmFyIHByb3BlcnRpZXMgPSBbJ2ltcHVsc2VhdG0nLCAnaW1wdWxzZXZhYycsICd0aHJ1c3RhdG0nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RocnVzdHZhYyddO1xuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BlcnRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBuZXdwYXJ0W3Byb3BlcnRpZXNbaV1dID1cbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNoZWNrUHJvcGVydHkocGFydCwgcHJvcGVydGllc1tpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzdGFnZS5wYXJ0c0xpc3QucHVzaChuZXdwYXJ0KTtcbiAgICAgICAgfVxuICAgICAgICBzdGFnZS5jYWxjdWxhdGUgPSBmdW5jdGlvbihwYXlsb2FkTWFzcykge1xuICAgICAgICAgICAgdmFyIHN1bXRocnVzdCwgc3VtZnVlbHVzZWQsIHRvdGFsaW1wdWxzZSwgZHYsIHN1bXdldG1hc3MsXG4gICAgICAgICAgICAgICAgc3VtZHJ5bWFzcywgdGhydXN0cmF0aW87XG4gICAgICAgICAgICBzdW10aHJ1c3QgPSBzdW1mdWVsdXNlZCA9IHRvdGFsaW1wdWxzZSA9IGR2ID0gdGhydXN0cmF0aW8gPSAwO1xuICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBhY2NvdW50IGZvciB0aGUgbWFzcyBvZiBhbGwgdXBwZXIgc3RhZ2VzLlxuICAgICAgICAgICAgc3VtZHJ5bWFzcyA9IHN1bXdldG1hc3MgPSBwYXlsb2FkTWFzcztcblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdGFnZS5wYXJ0c0xpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBzdW1kcnltYXNzICs9IHN0YWdlLnBhcnRzTGlzdFtpXS5kcnltYXNzO1xuICAgICAgICAgICAgICAgIHN1bXdldG1hc3MgKz0gc3RhZ2UucGFydHNMaXN0W2ldLndldG1hc3M7XG4gICAgICAgICAgICAgICAgdmFyIGltcHVsc2UsIHRocnVzdDtcbiAgICAgICAgICAgICAgICBpZiAoc3RhZ2UuYXRtKSB7XG4gICAgICAgICAgICAgICAgICAgIGltcHVsc2UgPSBzdGFnZS5wYXJ0c0xpc3RbaV0uaW1wdWxzZWF0bTtcbiAgICAgICAgICAgICAgICAgICAgdGhydXN0ID0gc3RhZ2UucGFydHNMaXN0W2ldLnRocnVzdGF0bTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpbXB1bHNlID0gc3RhZ2UucGFydHNMaXN0W2ldLmltcHVsc2V2YWM7XG4gICAgICAgICAgICAgICAgICAgIHRocnVzdCA9IHN0YWdlLnBhcnRzTGlzdFtpXS50aHJ1c3R2YWM7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpbXB1bHNlICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHN1bXRocnVzdCArPSB0aHJ1c3Q7XG4gICAgICAgICAgICAgICAgICAgIHN1bWZ1ZWx1c2VkICs9IHRocnVzdCAvIGltcHVsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHN1bWZ1ZWx1c2VkICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgdG90YWxpbXB1bHNlID0gc3VtdGhydXN0IC8gc3VtZnVlbHVzZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc3VtZHJ5bWFzcyAhPT0gMCkge1xuICAgICAgICAgICAgICAgIGR2ID0gTWF0aC5sb2coc3Vtd2V0bWFzcyAvIHN1bWRyeW1hc3MpXG4gICAgICAgICAgICAgICAgICAgICAqICRzY29wZS5ncmF2aXR5ICogdG90YWxpbXB1bHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHN1bXdldG1hc3MgIT09IDApIHtcbiAgICAgICAgICAgICAgICB0aHJ1c3RyYXRpbyA9IHN1bXRocnVzdCAvIChzdW13ZXRtYXNzICogJHNjb3BlLmdyYXZpdHkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHsnaW1wdWxzZScgOiB0b3RhbGltcHVsc2UsXG4gICAgICAgICAgICAgICAgICAgICd0aHJ1c3RyYXRpbycgOiB0aHJ1c3RyYXRpbyxcbiAgICAgICAgICAgICAgICAgICAgJ2R2JyA6IGR2LFxuICAgICAgICAgICAgICAgICAgICAnc3Vtd2V0bWFzcycgOiBzdW13ZXRtYXNzfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3RhZ2U7XG4gICAgfVxufV0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
