"use strict";var deevee=angular.module("deeVee",[]);deevee.controller("stageCtrl",["$scope","$http",function(t,a){a.get("parts/parts.json").success(function(a){t.parts=a,t.hideCats()}),t.isPartDialogOpen=function(){return t.partDialog?"partDialogOpen":""},t.catSelected=function(a){return t.parts[a].visible?"selected":""},t.hideCats=function(){for(var a=0;a<t.parts.length;a++)t.parts[a].visible=!1},t.toggleCat=function(a){t.hideCats(),t.parts[a].visible=!t.parts[a].visible},t.partDialog=!1,t.currentStage=!1,t.openPartDialog=function(a){t.currentStage=a,t.partDialog=!0},t.closePartDialog=function(){t.partDialog=!1,t.currentStage=!1},t.savePartDialog=function(a,s){t.addStagePart(a,s),t.closePartDialog()},t.gravity=9.81,t.totals={totaldv:0,totalmass:0,totalparts:0},t.checkProperty=function(t,a){return"number"==typeof t[a]?t[a]:0},t.stageList=[],t.addStage=function(){t.stageList.push(t.newStage()),t.updateTotals()},t.removeStage=function(a){t.stageList.splice(a,1),t.stageList.length>0&&t.updateCalculations(a),t.updateTotals()},t.addStagePart=function(a,s){t.stageList[a].addPart(s),t.updateCalculations(a),t.updateTotals()},t.removeStagePart=function(a,s){t.stageList[a].removePart(s),t.updateCalculations(a),t.updateTotals()},t.updateCalculations=function(a){if(0===a)t.stageList[a].result=t.stageList[a].calculate(0),t.stageList.length>0&&t.updateCalculations(1);else for(var s=a;s<t.stageList.length;s++){var e=t.stageList[s-1].result.sumwetmass;t.stageList[s].result=t.stageList[s].calculate(e)}},t.updateTotals=function(){var a,s,e;a=s=e=0;for(var r=0;r<t.stageList.length;r++)s+=t.stageList[r].result.dv,e+=t.stageList[r].partsList.length,r===t.stageList.length-1&&(a=t.stageList[r].result.sumwetmass);t.totals={totaldv:s,totalmass:a,totalparts:e}},t.newStage=function(){var a={};return a.atm=!0,a.partsList=[],a.result={impulse:0,thrustratio:0,dv:0,sumwetmass:0},a.removePart=function(t){var s=t>-1&&"undefined"!=typeof a.partsList[t];s&&a.partsList.splice(t,1),a.result=a.calculate(0)},a.addPart=function(s){for(var e={name:s.name,wetmass:s.wetmass,drymass:s.drymass},r=["impulseatm","impulsevac","thrustatm","thrustvac"],i=0;i<r.length;i++)e[r[i]]=t.checkProperty(s,r[i]);a.partsList.push(e)},a.calculate=function(s){var e,r,i,l,u,n,o;e=r=i=l=o=0,n=u=s;for(var c=0;c<a.partsList.length;c++){n+=a.partsList[c].drymass,u+=a.partsList[c].wetmass;var g,p;a.atm?(g=a.partsList[c].impulseatm,p=a.partsList[c].thrustatm):(g=a.partsList[c].impulsevac,p=a.partsList[c].thrustvac),0!==g&&(e+=p,r+=p/g)}return 0!==r&&(i=e/r),0!==n&&(l=Math.log(u/n)*t.gravity*i),0!==u&&(o=e/(u*t.gravity)),{impulse:i,thrustratio:o,dv:l,sumwetmass:u}},a}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJkZWV2ZWUiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29udHJvbGxlciIsIiRzY29wZSIsIiRodHRwIiwiZ2V0Iiwic3VjY2VzcyIsImRhdGEiLCJwYXJ0cyIsImhpZGVDYXRzIiwiaXNQYXJ0RGlhbG9nT3BlbiIsInBhcnREaWFsb2ciLCJjYXRTZWxlY3RlZCIsImluZGV4IiwidmlzaWJsZSIsImkiLCJsZW5ndGgiLCJ0b2dnbGVDYXQiLCJjYXRJbmRleCIsImN1cnJlbnRTdGFnZSIsIm9wZW5QYXJ0RGlhbG9nIiwic3RhZ2VJbmRleCIsImNsb3NlUGFydERpYWxvZyIsInNhdmVQYXJ0RGlhbG9nIiwicGFydCIsImFkZFN0YWdlUGFydCIsImdyYXZpdHkiLCJ0b3RhbHMiLCJ0b3RhbGR2IiwidG90YWxtYXNzIiwidG90YWxwYXJ0cyIsImNoZWNrUHJvcGVydHkiLCJwcm9wZXJ0eSIsInN0YWdlTGlzdCIsImFkZFN0YWdlIiwicHVzaCIsIm5ld1N0YWdlIiwidXBkYXRlVG90YWxzIiwicmVtb3ZlU3RhZ2UiLCJzcGxpY2UiLCJ1cGRhdGVDYWxjdWxhdGlvbnMiLCJhZGRQYXJ0IiwicmVtb3ZlU3RhZ2VQYXJ0IiwicGFydGlkIiwicmVtb3ZlUGFydCIsInJlc3VsdCIsImNhbGN1bGF0ZSIsImxvd2VyUmVzdWx0IiwidG90YWxNYXNzIiwidG90YWxQYXJ0cyIsImR2IiwicGFydHNMaXN0Iiwic3Vtd2V0bWFzcyIsInN0YWdlIiwiYXRtIiwiaW1wdWxzZSIsInRocnVzdHJhdGlvIiwicGFydEV4aXN0cyIsIm5ld3BhcnQiLCJuYW1lIiwid2V0bWFzcyIsImRyeW1hc3MiLCJwcm9wZXJ0aWVzIiwicGF5bG9hZE1hc3MiLCJzdW10aHJ1c3QiLCJzdW1mdWVsdXNlZCIsInRvdGFsaW1wdWxzZSIsInN1bWRyeW1hc3MiLCJ0aHJ1c3QiLCJpbXB1bHNlYXRtIiwidGhydXN0YXRtIiwiaW1wdWxzZXZhYyIsInRocnVzdHZhYyIsIk1hdGgiLCJsb2ciXSwibWFwcGluZ3MiOiJBQUFBLFlBRUEsSUFBSUEsUUFBU0MsUUFBUUMsT0FBTyxZQUU1QkYsUUFBT0csV0FBVyxhQUFjLFNBQVUsUUFBUyxTQUFTQyxFQUFRQyxHQUNoRUEsRUFBTUMsSUFBSSxvQkFBb0JDLFFBQVEsU0FBU0MsR0FDN0NKLEVBQU9LLE1BQVFELEVBQ2ZKLEVBQU9NLGFBRVROLEVBQU9PLGlCQUFtQixXQUN0QixNQUFPUCxHQUFPUSxXQUFhLGlCQUFtQixJQUVsRFIsRUFBT1MsWUFBYyxTQUFTQyxHQUMxQixNQUFPVixHQUFPSyxNQUFNSyxHQUFPQyxRQUFVLFdBQWEsSUFFdERYLEVBQU9NLFNBQVcsV0FDaEIsSUFBSyxHQUFJTSxHQUFJLEVBQUdBLEVBQUlaLEVBQU9LLE1BQU1RLE9BQVFELElBQ3JDWixFQUFPSyxNQUFNTyxHQUFHRCxTQUFVLEdBR2hDWCxFQUFPYyxVQUFZLFNBQVNDLEdBQ3hCZixFQUFPTSxXQUNQTixFQUFPSyxNQUFNVSxHQUFVSixTQUFXWCxFQUFPSyxNQUFNVSxHQUFVSixTQUU3RFgsRUFBT1EsWUFBYSxFQUNwQlIsRUFBT2dCLGNBQWUsRUFDdEJoQixFQUFPaUIsZUFBaUIsU0FBU0MsR0FDN0JsQixFQUFPZ0IsYUFBZUUsRUFDdEJsQixFQUFPUSxZQUFhLEdBRXhCUixFQUFPbUIsZ0JBQWtCLFdBQ3JCbkIsRUFBT1EsWUFBYSxFQUNwQlIsRUFBT2dCLGNBQWUsR0FFMUJoQixFQUFPb0IsZUFBaUIsU0FBU0YsRUFBWUcsR0FDekNyQixFQUFPc0IsYUFBYUosRUFBWUcsR0FDaENyQixFQUFPbUIsbUJBRVhuQixFQUFPdUIsUUFBVSxLQUNqQnZCLEVBQU93QixRQUFVQyxRQUFjLEVBQ2RDLFVBQWMsRUFDZEMsV0FBYyxHQUMvQjNCLEVBQU80QixjQUFnQixTQUFTUCxFQUFNUSxHQUVsQyxNQUE4QixnQkFBbkJSLEdBQUtRLEdBQ0xSLEVBQUtRLEdBRUwsR0FHZjdCLEVBQU84QixhQUNQOUIsRUFBTytCLFNBQVcsV0FDZC9CLEVBQU84QixVQUFVRSxLQUFLaEMsRUFBT2lDLFlBQzdCakMsRUFBT2tDLGdCQUVYbEMsRUFBT21DLFlBQWMsU0FBU2pCLEdBQzFCbEIsRUFBTzhCLFVBQVVNLE9BQU9sQixFQUFZLEdBQ2hDbEIsRUFBTzhCLFVBQVVqQixPQUFTLEdBQzFCYixFQUFPcUMsbUJBQW1CbkIsR0FFOUJsQixFQUFPa0MsZ0JBRVhsQyxFQUFPc0IsYUFBZSxTQUFTSixFQUFZRyxHQUN2Q3JCLEVBQU84QixVQUFVWixHQUFZb0IsUUFBUWpCLEdBQ3JDckIsRUFBT3FDLG1CQUFtQm5CLEdBQzFCbEIsRUFBT2tDLGdCQUVYbEMsRUFBT3VDLGdCQUFrQixTQUFTckIsRUFBWXNCLEdBQzFDeEMsRUFBTzhCLFVBQVVaLEdBQVl1QixXQUFXRCxHQUN4Q3hDLEVBQU9xQyxtQkFBbUJuQixHQUMxQmxCLEVBQU9rQyxnQkFFWGxDLEVBQU9xQyxtQkFBcUIsU0FBU25CLEdBRWpDLEdBQW1CLElBQWZBLEVBQ0FsQixFQUFPOEIsVUFBVVosR0FBWXdCLE9BQ3pCMUMsRUFBTzhCLFVBQVVaLEdBQVl5QixVQUFVLEdBQ3ZDM0MsRUFBTzhCLFVBQVVqQixPQUFTLEdBQzFCYixFQUFPcUMsbUJBQW1CLE9BSTlCLEtBQUssR0FBSXpCLEdBQUlNLEVBQVlOLEVBQUlaLEVBQU84QixVQUFVakIsT0FBUUQsSUFBSyxDQUN2RCxHQUFJZ0MsR0FBYzVDLEVBQU84QixVQUFVbEIsRUFBSSxHQUFHOEIsT0FBbUIsVUFDN0QxQyxHQUFPOEIsVUFBVWxCLEdBQUc4QixPQUNoQjFDLEVBQU84QixVQUFVbEIsR0FBRytCLFVBQVVDLEtBSTlDNUMsRUFBT2tDLGFBQWUsV0FDbEIsR0FBSVcsR0FBV3BCLEVBQVNxQixDQUN4QkQsR0FBWXBCLEVBQVVxQixFQUFhLENBQ25DLEtBQUssR0FBSWxDLEdBQUksRUFBR0EsRUFBSVosRUFBTzhCLFVBQVVqQixPQUFRRCxJQUN6Q2EsR0FBV3pCLEVBQU84QixVQUFVbEIsR0FBRzhCLE9BQU9LLEdBQ3RDRCxHQUFjOUMsRUFBTzhCLFVBQVVsQixHQUFHb0MsVUFBVW5DLE9BRXhDRCxJQUFNWixFQUFPOEIsVUFBVWpCLE9BQVMsSUFDaENnQyxFQUFZN0MsRUFBTzhCLFVBQVVsQixHQUFHOEIsT0FBT08sV0FJL0NqRCxHQUFPd0IsUUFBVUMsUUFBY0EsRUFDZEMsVUFBY21CLEVBQ2RsQixXQUFjbUIsSUFFbkM5QyxFQUFPaUMsU0FBVyxXQUNkLEdBQUlpQixLQWtFSixPQWpFQUEsR0FBTUMsS0FBTSxFQUNaRCxFQUFNRixhQUNORSxFQUFNUixRQUFVVSxRQUFZLEVBQ1pDLFlBQWdCLEVBQ2hCTixHQUFPLEVBQ1BFLFdBQWUsR0FDL0JDLEVBQU1ULFdBQWEsU0FBU0QsR0FDeEIsR0FBSWMsR0FBYWQsRUFBUyxJQUNnQixtQkFBNUJVLEdBQU1GLFVBQVVSLEVBQzFCYyxJQUNESixFQUFNRixVQUFVWixPQUFPSSxFQUFRLEdBRWxDVSxFQUFNUixPQUFTUSxFQUFNUCxVQUFVLElBRW5DTyxFQUFNWixRQUFVLFNBQVNqQixHQU9yQixJQUFLLEdBTkRrQyxJQUFXQyxLQUFTbkMsRUFBS21DLEtBQ2RDLFFBQVlwQyxFQUFLb0MsUUFDakJDLFFBQVlyQyxFQUFLcUMsU0FDNUJDLEdBQWMsYUFBYyxhQUFjLFlBQzVCLGFBRVQvQyxFQUFJLEVBQUdBLEVBQUkrQyxFQUFXOUMsT0FBUUQsSUFDbkMyQyxFQUFRSSxFQUFXL0MsSUFDZlosRUFBTzRCLGNBQWNQLEVBQU1zQyxFQUFXL0MsR0FFOUNzQyxHQUFNRixVQUFVaEIsS0FBS3VCLElBRXpCTCxFQUFNUCxVQUFZLFNBQVNpQixHQUN2QixHQUFJQyxHQUFXQyxFQUFhQyxFQUFjaEIsRUFBSUUsRUFDMUNlLEVBQVlYLENBQ2hCUSxHQUFZQyxFQUFjQyxFQUFlaEIsRUFBS00sRUFBYyxFQUU1RFcsRUFBYWYsRUFBYVcsQ0FFMUIsS0FBSyxHQUFJaEQsR0FBSSxFQUFHQSxFQUFJc0MsRUFBTUYsVUFBVW5DLE9BQVFELElBQUssQ0FDN0NvRCxHQUFjZCxFQUFNRixVQUFVcEMsR0FBRzhDLFFBQ2pDVCxHQUFjQyxFQUFNRixVQUFVcEMsR0FBRzZDLE9BQ2pDLElBQUlMLEdBQVNhLENBQ1RmLEdBQU1DLEtBQ05DLEVBQVVGLEVBQU1GLFVBQVVwQyxHQUFHc0QsV0FDN0JELEVBQVNmLEVBQU1GLFVBQVVwQyxHQUFHdUQsWUFFNUJmLEVBQVVGLEVBQU1GLFVBQVVwQyxHQUFHd0QsV0FDN0JILEVBQVNmLEVBQU1GLFVBQVVwQyxHQUFHeUQsV0FFaEIsSUFBWmpCLElBQ0FTLEdBQWFJLEVBQ2JILEdBQWVHLEVBQVNiLEdBYWhDLE1BVm9CLEtBQWhCVSxJQUNBQyxFQUFlRixFQUFZQyxHQUVaLElBQWZFLElBQ0FqQixFQUFLdUIsS0FBS0MsSUFBSXRCLEVBQWFlLEdBQ3BCaEUsRUFBT3VCLFFBQVV3QyxHQUVULElBQWZkLElBQ0FJLEVBQWNRLEdBQWFaLEVBQWFqRCxFQUFPdUIsV0FFM0M2QixRQUFZVyxFQUNaVixZQUFnQkEsRUFDaEJOLEdBQU9BLEVBQ1BFLFdBQWVBLElBRXBCQyIsImZpbGUiOiJhbGwubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgZGVldmVlID0gYW5ndWxhci5tb2R1bGUoJ2RlZVZlZScsIFtdKTtcblxuZGVldmVlLmNvbnRyb2xsZXIoJ3N0YWdlQ3RybCcsIFsnJHNjb3BlJywgJyRodHRwJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCkge1xuICAgICRodHRwLmdldCgncGFydHMvcGFydHMuanNvbicpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgJHNjb3BlLnBhcnRzID0gZGF0YTtcbiAgICAgICRzY29wZS5oaWRlQ2F0cygpO1xuICAgIH0pO1xuICAgICRzY29wZS5pc1BhcnREaWFsb2dPcGVuID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiAkc2NvcGUucGFydERpYWxvZyA/ICdwYXJ0RGlhbG9nT3BlbicgOiAnJztcbiAgICB9XG4gICAgJHNjb3BlLmNhdFNlbGVjdGVkID0gZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuICRzY29wZS5wYXJ0c1tpbmRleF0udmlzaWJsZSA/ICdzZWxlY3RlZCcgOiAnJztcbiAgICB9XG4gICAgJHNjb3BlLmhpZGVDYXRzID0gZnVuY3Rpb24oKSB7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8ICRzY29wZS5wYXJ0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICRzY29wZS5wYXJ0c1tpXS52aXNpYmxlID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgICRzY29wZS50b2dnbGVDYXQgPSBmdW5jdGlvbihjYXRJbmRleCkge1xuICAgICAgICAkc2NvcGUuaGlkZUNhdHMoKTtcbiAgICAgICAgJHNjb3BlLnBhcnRzW2NhdEluZGV4XS52aXNpYmxlID0gISRzY29wZS5wYXJ0c1tjYXRJbmRleF0udmlzaWJsZTtcbiAgICB9XG4gICAgJHNjb3BlLnBhcnREaWFsb2cgPSBmYWxzZTtcbiAgICAkc2NvcGUuY3VycmVudFN0YWdlID0gZmFsc2U7XG4gICAgJHNjb3BlLm9wZW5QYXJ0RGlhbG9nID0gZnVuY3Rpb24oc3RhZ2VJbmRleCkge1xuICAgICAgICAkc2NvcGUuY3VycmVudFN0YWdlID0gc3RhZ2VJbmRleDtcbiAgICAgICAgJHNjb3BlLnBhcnREaWFsb2cgPSB0cnVlO1xuICAgIH1cbiAgICAkc2NvcGUuY2xvc2VQYXJ0RGlhbG9nID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICRzY29wZS5wYXJ0RGlhbG9nID0gZmFsc2U7XG4gICAgICAgICRzY29wZS5jdXJyZW50U3RhZ2UgPSBmYWxzZTtcbiAgICB9XG4gICAgJHNjb3BlLnNhdmVQYXJ0RGlhbG9nID0gZnVuY3Rpb24oc3RhZ2VJbmRleCwgcGFydCkge1xuICAgICAgICAkc2NvcGUuYWRkU3RhZ2VQYXJ0KHN0YWdlSW5kZXgsIHBhcnQpO1xuICAgICAgICAkc2NvcGUuY2xvc2VQYXJ0RGlhbG9nKCk7XG4gICAgfVxuICAgICRzY29wZS5ncmF2aXR5ID0gOS44MTtcbiAgICAkc2NvcGUudG90YWxzID0geyd0b3RhbGR2JyAgIDogMCxcbiAgICAgICAgICAgICAgICAgICAgICd0b3RhbG1hc3MnIDogMCxcbiAgICAgICAgICAgICAgICAgICAgICd0b3RhbHBhcnRzJzogMH07XG4gICAgJHNjb3BlLmNoZWNrUHJvcGVydHkgPSBmdW5jdGlvbihwYXJ0LCBwcm9wZXJ0eSkge1xuICAgICAgICAvLyBJZiBhIHBhcnQgZG9lc24ndCBoYXZlIGFuIGltcHVsc2Ugb3IgdGhydXN0IHZhbHVlLCBhc3N1bWUgemVyby5cbiAgICAgICAgaWYgKHR5cGVvZiBwYXJ0W3Byb3BlcnR5XSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHJldHVybiBwYXJ0W3Byb3BlcnR5XTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgfVxuICAgICRzY29wZS5zdGFnZUxpc3QgPSBbXTtcbiAgICAkc2NvcGUuYWRkU3RhZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgJHNjb3BlLnN0YWdlTGlzdC5wdXNoKCRzY29wZS5uZXdTdGFnZSgpKTtcbiAgICAgICAgJHNjb3BlLnVwZGF0ZVRvdGFscygpO1xuICAgIH1cbiAgICAkc2NvcGUucmVtb3ZlU3RhZ2UgPSBmdW5jdGlvbihzdGFnZUluZGV4KSB7XG4gICAgICAgICRzY29wZS5zdGFnZUxpc3Quc3BsaWNlKHN0YWdlSW5kZXgsIDEpO1xuICAgICAgICBpZiAoJHNjb3BlLnN0YWdlTGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAkc2NvcGUudXBkYXRlQ2FsY3VsYXRpb25zKHN0YWdlSW5kZXgpO1xuICAgICAgICB9XG4gICAgICAgICRzY29wZS51cGRhdGVUb3RhbHMoKTtcbiAgICB9XG4gICAgJHNjb3BlLmFkZFN0YWdlUGFydCA9IGZ1bmN0aW9uKHN0YWdlSW5kZXgsIHBhcnQpIHtcbiAgICAgICAgJHNjb3BlLnN0YWdlTGlzdFtzdGFnZUluZGV4XS5hZGRQYXJ0KHBhcnQpO1xuICAgICAgICAkc2NvcGUudXBkYXRlQ2FsY3VsYXRpb25zKHN0YWdlSW5kZXgpO1xuICAgICAgICAkc2NvcGUudXBkYXRlVG90YWxzKCk7XG4gICAgfVxuICAgICRzY29wZS5yZW1vdmVTdGFnZVBhcnQgPSBmdW5jdGlvbihzdGFnZUluZGV4LCBwYXJ0aWQpIHtcbiAgICAgICAgJHNjb3BlLnN0YWdlTGlzdFtzdGFnZUluZGV4XS5yZW1vdmVQYXJ0KHBhcnRpZCk7XG4gICAgICAgICRzY29wZS51cGRhdGVDYWxjdWxhdGlvbnMoc3RhZ2VJbmRleCk7XG4gICAgICAgICRzY29wZS51cGRhdGVUb3RhbHMoKTtcbiAgICB9XG4gICAgJHNjb3BlLnVwZGF0ZUNhbGN1bGF0aW9ucyA9IGZ1bmN0aW9uKHN0YWdlSW5kZXgpIHtcbiAgICAgICAgLy8gVGhlIHVwcGVybW9zdCBzdGFnZSBoYXMgbm8gcGF5bG9hZCB0byBmYWN0b3IgaW4uXG4gICAgICAgIGlmIChzdGFnZUluZGV4ID09PSAwKSB7XG4gICAgICAgICAgICAkc2NvcGUuc3RhZ2VMaXN0W3N0YWdlSW5kZXhdLnJlc3VsdCA9IFxuICAgICAgICAgICAgICAgICRzY29wZS5zdGFnZUxpc3Rbc3RhZ2VJbmRleF0uY2FsY3VsYXRlKDApO1xuICAgICAgICAgICAgaWYgKCRzY29wZS5zdGFnZUxpc3QubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICRzY29wZS51cGRhdGVDYWxjdWxhdGlvbnMoMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBSZWNhbGN1bGF0ZSBhbGwgc3RhZ2VzIGJlbG93IHRoaXMgb25lIGFzIHdlbGwuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gc3RhZ2VJbmRleDsgaSA8ICRzY29wZS5zdGFnZUxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgbG93ZXJSZXN1bHQgPSAkc2NvcGUuc3RhZ2VMaXN0W2kgLSAxXS5yZXN1bHRbJ3N1bXdldG1hc3MnXTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc3RhZ2VMaXN0W2ldLnJlc3VsdCA9XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zdGFnZUxpc3RbaV0uY2FsY3VsYXRlKGxvd2VyUmVzdWx0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAkc2NvcGUudXBkYXRlVG90YWxzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0b3RhbE1hc3MsIHRvdGFsZHYsIHRvdGFsUGFydHM7XG4gICAgICAgIHRvdGFsTWFzcyA9IHRvdGFsZHYgPSB0b3RhbFBhcnRzID0gMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkc2NvcGUuc3RhZ2VMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0b3RhbGR2ICs9ICRzY29wZS5zdGFnZUxpc3RbaV0ucmVzdWx0LmR2O1xuICAgICAgICAgICAgdG90YWxQYXJ0cyArPSAkc2NvcGUuc3RhZ2VMaXN0W2ldLnBhcnRzTGlzdC5sZW5ndGg7XG4gICAgICAgICAgICAvLyBVc2UgdGhlIHZhbHVlIG9mIHRoZSBsYXN0IHN0YWdlLCBhcyBzdW13ZXRtYXNzIGlzIGN1bXVsYXRpdmUuXG4gICAgICAgICAgICBpZiAoaSA9PT0gJHNjb3BlLnN0YWdlTGlzdC5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgdG90YWxNYXNzID0gJHNjb3BlLnN0YWdlTGlzdFtpXS5yZXN1bHQuc3Vtd2V0bWFzcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgICRzY29wZS50b3RhbHMgPSB7J3RvdGFsZHYnICAgOiB0b3RhbGR2LFxuICAgICAgICAgICAgICAgICAgICAgICAgICd0b3RhbG1hc3MnIDogdG90YWxNYXNzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICd0b3RhbHBhcnRzJzogdG90YWxQYXJ0c307XG4gICAgfVxuICAgICRzY29wZS5uZXdTdGFnZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc3RhZ2UgPSB7fTtcbiAgICAgICAgc3RhZ2UuYXRtID0gdHJ1ZTtcbiAgICAgICAgc3RhZ2UucGFydHNMaXN0ID0gW107XG4gICAgICAgIHN0YWdlLnJlc3VsdCA9IHsnaW1wdWxzZScgOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3RocnVzdHJhdGlvJyA6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAnZHYnIDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdzdW13ZXRtYXNzJyA6IDB9O1xuICAgICAgICBzdGFnZS5yZW1vdmVQYXJ0ID0gZnVuY3Rpb24ocGFydGlkKSB7XG4gICAgICAgICAgICB2YXIgcGFydEV4aXN0cyA9IHBhcnRpZCA+IC0xXG4gICAgICAgICAgICAgICAgJiYgdHlwZW9mIHN0YWdlLnBhcnRzTGlzdFtwYXJ0aWRdICE9PSAndW5kZWZpbmVkJztcbiAgICAgICAgICAgIGlmIChwYXJ0RXhpc3RzKSB7XG4gICAgICAgICAgICAgICBzdGFnZS5wYXJ0c0xpc3Quc3BsaWNlKHBhcnRpZCwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzdGFnZS5yZXN1bHQgPSBzdGFnZS5jYWxjdWxhdGUoMCk7XG4gICAgICAgIH1cbiAgICAgICAgc3RhZ2UuYWRkUGFydCA9IGZ1bmN0aW9uKHBhcnQpIHtcbiAgICAgICAgICAgIHZhciBuZXdwYXJ0ID0geyduYW1lJyA6IHBhcnQubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICd3ZXRtYXNzJyA6IHBhcnQud2V0bWFzcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICdkcnltYXNzJyA6IHBhcnQuZHJ5bWFzc307XG4gICAgICAgICAgICB2YXIgcHJvcGVydGllcyA9IFsnaW1wdWxzZWF0bScsICdpbXB1bHNldmFjJywgJ3RocnVzdGF0bScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGhydXN0dmFjJ107XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcGVydGllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIG5ld3BhcnRbcHJvcGVydGllc1tpXV0gPVxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2hlY2tQcm9wZXJ0eShwYXJ0LCBwcm9wZXJ0aWVzW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN0YWdlLnBhcnRzTGlzdC5wdXNoKG5ld3BhcnQpO1xuICAgICAgICB9XG4gICAgICAgIHN0YWdlLmNhbGN1bGF0ZSA9IGZ1bmN0aW9uKHBheWxvYWRNYXNzKSB7XG4gICAgICAgICAgICB2YXIgc3VtdGhydXN0LCBzdW1mdWVsdXNlZCwgdG90YWxpbXB1bHNlLCBkdiwgc3Vtd2V0bWFzcyxcbiAgICAgICAgICAgICAgICBzdW1kcnltYXNzLCB0aHJ1c3RyYXRpbztcbiAgICAgICAgICAgIHN1bXRocnVzdCA9IHN1bWZ1ZWx1c2VkID0gdG90YWxpbXB1bHNlID0gZHYgPSB0aHJ1c3RyYXRpbyA9IDA7XG4gICAgICAgICAgICAvLyBXZSBuZWVkIHRvIGFjY291bnQgZm9yIHRoZSBtYXNzIG9mIGFsbCB1cHBlciBzdGFnZXMuXG4gICAgICAgICAgICBzdW1kcnltYXNzID0gc3Vtd2V0bWFzcyA9IHBheWxvYWRNYXNzO1xuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0YWdlLnBhcnRzTGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHN1bWRyeW1hc3MgKz0gc3RhZ2UucGFydHNMaXN0W2ldLmRyeW1hc3M7XG4gICAgICAgICAgICAgICAgc3Vtd2V0bWFzcyArPSBzdGFnZS5wYXJ0c0xpc3RbaV0ud2V0bWFzcztcbiAgICAgICAgICAgICAgICB2YXIgaW1wdWxzZSwgdGhydXN0O1xuICAgICAgICAgICAgICAgIGlmIChzdGFnZS5hdG0pIHtcbiAgICAgICAgICAgICAgICAgICAgaW1wdWxzZSA9IHN0YWdlLnBhcnRzTGlzdFtpXS5pbXB1bHNlYXRtO1xuICAgICAgICAgICAgICAgICAgICB0aHJ1c3QgPSBzdGFnZS5wYXJ0c0xpc3RbaV0udGhydXN0YXRtO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGltcHVsc2UgPSBzdGFnZS5wYXJ0c0xpc3RbaV0uaW1wdWxzZXZhYztcbiAgICAgICAgICAgICAgICAgICAgdGhydXN0ID0gc3RhZ2UucGFydHNMaXN0W2ldLnRocnVzdHZhYztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGltcHVsc2UgIT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgc3VtdGhydXN0ICs9IHRocnVzdDtcbiAgICAgICAgICAgICAgICAgICAgc3VtZnVlbHVzZWQgKz0gdGhydXN0IC8gaW1wdWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc3VtZnVlbHVzZWQgIT09IDApIHtcbiAgICAgICAgICAgICAgICB0b3RhbGltcHVsc2UgPSBzdW10aHJ1c3QgLyBzdW1mdWVsdXNlZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdW1kcnltYXNzICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgZHYgPSBNYXRoLmxvZyhzdW13ZXRtYXNzIC8gc3VtZHJ5bWFzcylcbiAgICAgICAgICAgICAgICAgICAgICogJHNjb3BlLmdyYXZpdHkgKiB0b3RhbGltcHVsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc3Vtd2V0bWFzcyAhPT0gMCkge1xuICAgICAgICAgICAgICAgIHRocnVzdHJhdGlvID0gc3VtdGhydXN0IC8gKHN1bXdldG1hc3MgKiAkc2NvcGUuZ3Jhdml0eSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4geydpbXB1bHNlJyA6IHRvdGFsaW1wdWxzZSxcbiAgICAgICAgICAgICAgICAgICAgJ3RocnVzdHJhdGlvJyA6IHRocnVzdHJhdGlvLFxuICAgICAgICAgICAgICAgICAgICAnZHYnIDogZHYsXG4gICAgICAgICAgICAgICAgICAgICdzdW13ZXRtYXNzJyA6IHN1bXdldG1hc3N9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdGFnZTtcbiAgICB9XG59XSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
