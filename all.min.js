"use strict";var deevee=angular.module("deeVee",[]);deevee.controller("stageCtrl",["$scope","$http",function(t,a){a.get("parts/parts.json").success(function(a){t.parts=a,t.hideCats()}),t.multiplier=1,t.multiClass=function(){return t.multiplier>1?"highlight-blue":""},t.incrementMultiplier=function(){t.multiplier>4?t.multiplier=1:t.multiplier++},t.isPartDialogOpen=function(){return t.partDialog?"partDialogOpen":""},t.catSelected=function(a){return t.parts[a].visible?"selected":""},t.hideCats=function(){for(var a=0;a<t.parts.length;a++)t.parts[a].visible=!1},t.toggleCat=function(a){t.hideCats(),t.parts[a].visible=!t.parts[a].visible},t.partDialog=!1,t.currentStage=!1,t.openPartDialog=function(a){t.currentStage=a,t.partDialog=!0,t.multiplier=1},t.closePartDialog=function(){t.partDialog=!1,t.currentStage=!1},t.savePartDialog=function(a,s){t.addStagePart(a,s,t.multiplier),t.closePartDialog()},t.gravity=9.81,t.totals={totaldv:0,totalmass:0,totalparts:0},t.checkProperty=function(t,a){return"number"==typeof t[a]?t[a]:0},t.stageList=[],t.addStage=function(){t.stageList.push(t.newStage()),t.updateTotals()},t.removeStage=function(a){t.stageList.splice(a,1),t.stageList.length>0&&t.updateCalculations(a),t.updateTotals()},t.addStagePart=function(a,s,e){for(var r=0;e>r;r++)console.log("adding: "+s),t.stageList[a].addPart(s);t.updateCalculations(a),t.updateTotals()},t.removeStagePart=function(a,s){t.stageList[a].removePart(s),t.updateCalculations(a),t.updateTotals()},t.updateCalculations=function(a){if(0===a)t.stageList[a].result=t.stageList[a].calculate(0),t.stageList.length>0&&t.updateCalculations(1);else for(var s=a;s<t.stageList.length;s++){var e=t.stageList[s-1].result.sumwetmass;t.stageList[s].result=t.stageList[s].calculate(e)}},t.updateTotals=function(){var a,s,e;a=s=e=0;for(var r=0;r<t.stageList.length;r++)s+=t.stageList[r].result.dv,e+=t.stageList[r].partsList.length,r===t.stageList.length-1&&(a=t.stageList[r].result.sumwetmass);t.totals={totaldv:s,totalmass:a,totalparts:e}},t.newStage=function(){var a={};return a.atm=!0,a.partsList=[],a.result={impulse:0,thrustratio:0,dv:0,sumwetmass:0},a.removePart=function(t){var s=t>-1&&"undefined"!=typeof a.partsList[t];s&&a.partsList.splice(t,1),a.result=a.calculate(0)},a.addPart=function(s){for(var e={name:s.name,wetmass:s.wetmass,drymass:s.drymass},r=["impulseatm","impulsevac","thrustatm","thrustvac"],i=0;i<r.length;i++)e[r[i]]=t.checkProperty(s,r[i]);a.partsList.push(e)},a.calculate=function(s){var e,r,i,l,u,n,o;e=r=i=l=o=0,n=u=s;for(var p=0;p<a.partsList.length;p++){n+=a.partsList[p].drymass,u+=a.partsList[p].wetmass;var c,g;a.atm?(c=a.partsList[p].impulseatm,g=a.partsList[p].thrustatm):(c=a.partsList[p].impulsevac,g=a.partsList[p].thrustvac),0!==c&&(e+=g,r+=g/c)}return 0!==r&&(i=e/r),0!==n&&(l=Math.log(u/n)*t.gravity*i),0!==u&&(o=e/(u*t.gravity)),{impulse:i,thrustratio:o,dv:l,sumwetmass:u}},a}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJkZWV2ZWUiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29udHJvbGxlciIsIiRzY29wZSIsIiRodHRwIiwiZ2V0Iiwic3VjY2VzcyIsImRhdGEiLCJwYXJ0cyIsImhpZGVDYXRzIiwibXVsdGlwbGllciIsIm11bHRpQ2xhc3MiLCJpbmNyZW1lbnRNdWx0aXBsaWVyIiwiaXNQYXJ0RGlhbG9nT3BlbiIsInBhcnREaWFsb2ciLCJjYXRTZWxlY3RlZCIsImluZGV4IiwidmlzaWJsZSIsImkiLCJsZW5ndGgiLCJ0b2dnbGVDYXQiLCJjYXRJbmRleCIsImN1cnJlbnRTdGFnZSIsIm9wZW5QYXJ0RGlhbG9nIiwic3RhZ2VJbmRleCIsImNsb3NlUGFydERpYWxvZyIsInNhdmVQYXJ0RGlhbG9nIiwicGFydCIsImFkZFN0YWdlUGFydCIsImdyYXZpdHkiLCJ0b3RhbHMiLCJ0b3RhbGR2IiwidG90YWxtYXNzIiwidG90YWxwYXJ0cyIsImNoZWNrUHJvcGVydHkiLCJwcm9wZXJ0eSIsInN0YWdlTGlzdCIsImFkZFN0YWdlIiwicHVzaCIsIm5ld1N0YWdlIiwidXBkYXRlVG90YWxzIiwicmVtb3ZlU3RhZ2UiLCJzcGxpY2UiLCJ1cGRhdGVDYWxjdWxhdGlvbnMiLCJjb25zb2xlIiwibG9nIiwiYWRkUGFydCIsInJlbW92ZVN0YWdlUGFydCIsInBhcnRpZCIsInJlbW92ZVBhcnQiLCJyZXN1bHQiLCJjYWxjdWxhdGUiLCJwcmV2UmVzdWx0IiwidG90YWxNYXNzIiwidG90YWxQYXJ0cyIsImR2IiwicGFydHNMaXN0Iiwic3Vtd2V0bWFzcyIsInN0YWdlIiwiYXRtIiwiaW1wdWxzZSIsInRocnVzdHJhdGlvIiwicGFydEV4aXN0cyIsIm5ld3BhcnQiLCJuYW1lIiwid2V0bWFzcyIsImRyeW1hc3MiLCJwcm9wZXJ0aWVzIiwicGF5bG9hZE1hc3MiLCJzdW10aHJ1c3QiLCJzdW1mdWVsdXNlZCIsInRvdGFsaW1wdWxzZSIsInN1bWRyeW1hc3MiLCJ0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ZixFQUFPK0IsY0FBY1AsRUFBTXdDLEVBQVdqRCxHQUU5Q3dDLEdBQU1GLFVBQVVsQixLQUFLeUIsSUFFekJMLEVBQU1QLFVBQVksU0FBU2lCLEdBQ3ZCLEdBQUlDLEdBQVdDLEVBQWFDLEVBQWNoQixFQUFJRSxFQUMxQ2UsRUFBWVgsQ0FDaEJRLEdBQVlDLEVBQWNDLEVBQWVoQixFQUFLTSxFQUFjLEVBRTVEVyxFQUFhZixFQUFhVyxDQUUxQixLQUFLLEdBQUlsRCxHQUFJLEVBQUdBLEVBQUl3QyxFQUFNRixVQUFVckMsT0FBUUQsSUFBSyxDQUM3Q3NELEdBQWNkLEVBQU1GLFVBQVV0QyxHQUFHZ0QsUUFDakNULEdBQWNDLEVBQU1GLFVBQVV0QyxHQUFHK0MsT0FDakMsSUFBSUwsR0FBU2EsQ0FDVGYsR0FBTUMsS0FDTkMsRUFBVUYsRUFBTUYsVUFBVXRDLEdBQUd3RCxXQUM3QkQsRUFBU2YsRUFBTUYsVUFBVXRDLEdBQUd5RCxZQUU1QmYsRUFBVUYsRUFBTUYsVUFBVXRDLEdBQUcwRCxXQUM3QkgsRUFBU2YsRUFBTUYsVUFBVXRDLEdBQUcyRCxXQUVoQixJQUFaakIsSUFDQVMsR0FBYUksRUFDYkgsR0FBZUcsRUFBU2IsR0FhaEMsTUFWb0IsS0FBaEJVLElBQ0FDLEVBQWVGLEVBQVlDLEdBRVosSUFBZkUsSUFDQWpCLEVBQUt1QixLQUFLakMsSUFBSVksRUFBYWUsR0FDcEJyRSxFQUFPMEIsUUFBVTBDLEdBRVQsSUFBZmQsSUFDQUksRUFBY1EsR0FBYVosRUFBYXRELEVBQU8wQixXQUUzQytCLFFBQVlXLEVBQ1pWLFlBQWdCQSxFQUNoQk4sR0FBT0EsRUFDUEUsV0FBZUEsSUFFcEJDIiwiZmlsZSI6ImFsbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbnZhciBkZWV2ZWUgPSBhbmd1bGFyLm1vZHVsZSgnZGVlVmVlJywgW10pO1xuXG5kZWV2ZWUuY29udHJvbGxlcignc3RhZ2VDdHJsJywgWyckc2NvcGUnLCAnJGh0dHAnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwKSB7XG4gICAgJGh0dHAuZ2V0KCdwYXJ0cy9wYXJ0cy5qc29uJykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAkc2NvcGUucGFydHMgPSBkYXRhO1xuICAgICAgJHNjb3BlLmhpZGVDYXRzKCk7XG4gICAgfSk7XG4gICAgJHNjb3BlLm11bHRpcGxpZXIgPSAxO1xuICAgICRzY29wZS5tdWx0aUNsYXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICgkc2NvcGUubXVsdGlwbGllciA+IDEpIHtcbiAgICAgICAgICAgIHJldHVybiAnaGlnaGxpZ2h0LWJsdWUnO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnJztcbiAgICB9XG4gICAgJHNjb3BlLmluY3JlbWVudE11bHRpcGxpZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCRzY29wZS5tdWx0aXBsaWVyID4gNCkge1xuICAgICAgICAgICAgJHNjb3BlLm11bHRpcGxpZXIgPSAxO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJHNjb3BlLm11bHRpcGxpZXIrKztcbiAgICAgICAgfVxuICAgIH1cbiAgICAkc2NvcGUuaXNQYXJ0RGlhbG9nT3BlbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gJHNjb3BlLnBhcnREaWFsb2cgPyAncGFydERpYWxvZ09wZW4nIDogJyc7XG4gICAgfVxuICAgICRzY29wZS5jYXRTZWxlY3RlZCA9IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICAgIHJldHVybiAkc2NvcGUucGFydHNbaW5kZXhdLnZpc2libGUgPyAnc2VsZWN0ZWQnIDogJyc7XG4gICAgfVxuICAgICRzY29wZS5oaWRlQ2F0cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkc2NvcGUucGFydHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAkc2NvcGUucGFydHNbaV0udmlzaWJsZSA9IGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICAkc2NvcGUudG9nZ2xlQ2F0ID0gZnVuY3Rpb24oY2F0SW5kZXgpIHtcbiAgICAgICAgJHNjb3BlLmhpZGVDYXRzKCk7XG4gICAgICAgICRzY29wZS5wYXJ0c1tjYXRJbmRleF0udmlzaWJsZSA9ICEkc2NvcGUucGFydHNbY2F0SW5kZXhdLnZpc2libGU7XG4gICAgfVxuICAgICRzY29wZS5wYXJ0RGlhbG9nID0gZmFsc2U7XG4gICAgJHNjb3BlLmN1cnJlbnRTdGFnZSA9IGZhbHNlO1xuICAgICRzY29wZS5vcGVuUGFydERpYWxvZyA9IGZ1bmN0aW9uKHN0YWdlSW5kZXgpIHtcbiAgICAgICAgJHNjb3BlLmN1cnJlbnRTdGFnZSA9IHN0YWdlSW5kZXg7XG4gICAgICAgICRzY29wZS5wYXJ0RGlhbG9nID0gdHJ1ZTtcbiAgICAgICAgJHNjb3BlLm11bHRpcGxpZXIgPSAxO1xuICAgIH1cbiAgICAkc2NvcGUuY2xvc2VQYXJ0RGlhbG9nID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICRzY29wZS5wYXJ0RGlhbG9nID0gZmFsc2U7XG4gICAgICAgICRzY29wZS5jdXJyZW50U3RhZ2UgPSBmYWxzZTtcbiAgICB9XG4gICAgJHNjb3BlLnNhdmVQYXJ0RGlhbG9nID0gZnVuY3Rpb24oc3RhZ2VJbmRleCwgcGFydCkge1xuICAgICAgICAkc2NvcGUuYWRkU3RhZ2VQYXJ0KHN0YWdlSW5kZXgsIHBhcnQsICRzY29wZS5tdWx0aXBsaWVyKTtcbiAgICAgICAgJHNjb3BlLmNsb3NlUGFydERpYWxvZygpO1xuICAgIH1cbiAgICAkc2NvcGUuZ3Jhdml0eSA9IDkuODE7XG4gICAgJHNjb3BlLnRvdGFscyA9IHsndG90YWxkdicgICA6IDAsXG4gICAgICAgICAgICAgICAgICAgICAndG90YWxtYXNzJyA6IDAsXG4gICAgICAgICAgICAgICAgICAgICAndG90YWxwYXJ0cyc6IDB9O1xuICAgICRzY29wZS5jaGVja1Byb3BlcnR5ID0gZnVuY3Rpb24ocGFydCwgcHJvcGVydHkpIHtcbiAgICAgICAgLy8gSWYgYSBwYXJ0IGRvZXNuJ3QgaGF2ZSBhbiBpbXB1bHNlIG9yIHRocnVzdCB2YWx1ZSwgYXNzdW1lIHplcm8uXG4gICAgICAgIGlmICh0eXBlb2YgcGFydFtwcm9wZXJ0eV0gPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICByZXR1cm4gcGFydFtwcm9wZXJ0eV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgIH1cbiAgICAkc2NvcGUuc3RhZ2VMaXN0ID0gW107XG4gICAgJHNjb3BlLmFkZFN0YWdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICRzY29wZS5zdGFnZUxpc3QucHVzaCgkc2NvcGUubmV3U3RhZ2UoKSk7XG4gICAgICAgICRzY29wZS51cGRhdGVUb3RhbHMoKTtcbiAgICB9XG4gICAgJHNjb3BlLnJlbW92ZVN0YWdlID0gZnVuY3Rpb24oc3RhZ2VJbmRleCkge1xuICAgICAgICAkc2NvcGUuc3RhZ2VMaXN0LnNwbGljZShzdGFnZUluZGV4LCAxKTtcbiAgICAgICAgaWYgKCRzY29wZS5zdGFnZUxpc3QubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgJHNjb3BlLnVwZGF0ZUNhbGN1bGF0aW9ucyhzdGFnZUluZGV4KTtcbiAgICAgICAgfVxuICAgICAgICAkc2NvcGUudXBkYXRlVG90YWxzKCk7XG4gICAgfVxuICAgICRzY29wZS5hZGRTdGFnZVBhcnQgPSBmdW5jdGlvbihzdGFnZUluZGV4LCBwYXJ0LCBtdWx0aXBsaWVyKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbXVsdGlwbGllcjsgaSsrKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnYWRkaW5nOiAnK3BhcnQpO1xuICAgICAgICAgICAgJHNjb3BlLnN0YWdlTGlzdFtzdGFnZUluZGV4XS5hZGRQYXJ0KHBhcnQpO1xuICAgICAgICB9XG4gICAgICAgICRzY29wZS51cGRhdGVDYWxjdWxhdGlvbnMoc3RhZ2VJbmRleCk7XG4gICAgICAgICRzY29wZS51cGRhdGVUb3RhbHMoKTtcbiAgICB9XG4gICAgJHNjb3BlLnJlbW92ZVN0YWdlUGFydCA9IGZ1bmN0aW9uKHN0YWdlSW5kZXgsIHBhcnRpZCkge1xuICAgICAgICAkc2NvcGUuc3RhZ2VMaXN0W3N0YWdlSW5kZXhdLnJlbW92ZVBhcnQocGFydGlkKTtcbiAgICAgICAgJHNjb3BlLnVwZGF0ZUNhbGN1bGF0aW9ucyhzdGFnZUluZGV4KTtcbiAgICAgICAgJHNjb3BlLnVwZGF0ZVRvdGFscygpO1xuICAgIH1cbiAgICAkc2NvcGUudXBkYXRlQ2FsY3VsYXRpb25zID0gZnVuY3Rpb24oc3RhZ2VJbmRleCkge1xuICAgICAgICAvLyBUaGUgdXBwZXJtb3N0IHN0YWdlIGhhcyBubyBwYXlsb2FkIHRvIGZhY3RvciBpbi5cbiAgICAgICAgaWYgKHN0YWdlSW5kZXggPT09IDApIHtcbiAgICAgICAgICAgICRzY29wZS5zdGFnZUxpc3Rbc3RhZ2VJbmRleF0ucmVzdWx0ID1cbiAgICAgICAgICAgICAgICAkc2NvcGUuc3RhZ2VMaXN0W3N0YWdlSW5kZXhdLmNhbGN1bGF0ZSgwKTtcbiAgICAgICAgICAgIGlmICgkc2NvcGUuc3RhZ2VMaXN0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUudXBkYXRlQ2FsY3VsYXRpb25zKDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gUmVjYWxjdWxhdGUgYWxsIHN0YWdlcyBiZWxvdyB0aGlzIG9uZSBhcyB3ZWxsLlxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IHN0YWdlSW5kZXg7IGkgPCAkc2NvcGUuc3RhZ2VMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHByZXZSZXN1bHQgPSAkc2NvcGUuc3RhZ2VMaXN0W2kgLSAxXS5yZXN1bHRbJ3N1bXdldG1hc3MnXTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc3RhZ2VMaXN0W2ldLnJlc3VsdCA9XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zdGFnZUxpc3RbaV0uY2FsY3VsYXRlKHByZXZSZXN1bHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgICRzY29wZS51cGRhdGVUb3RhbHMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRvdGFsTWFzcywgdG90YWxkdiwgdG90YWxQYXJ0cztcbiAgICAgICAgdG90YWxNYXNzID0gdG90YWxkdiA9IHRvdGFsUGFydHMgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8ICRzY29wZS5zdGFnZUxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRvdGFsZHYgKz0gJHNjb3BlLnN0YWdlTGlzdFtpXS5yZXN1bHQuZHY7XG4gICAgICAgICAgICB0b3RhbFBhcnRzICs9ICRzY29wZS5zdGFnZUxpc3RbaV0ucGFydHNMaXN0Lmxlbmd0aDtcbiAgICAgICAgICAgIC8vIFVzZSB0aGUgdmFsdWUgb2YgdGhlIGxhc3Qgc3RhZ2UsIGFzIHN1bXdldG1hc3MgaXMgY3VtdWxhdGl2ZS5cbiAgICAgICAgICAgIGlmIChpID09PSAkc2NvcGUuc3RhZ2VMaXN0Lmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICB0b3RhbE1hc3MgPSAkc2NvcGUuc3RhZ2VMaXN0W2ldLnJlc3VsdC5zdW13ZXRtYXNzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgJHNjb3BlLnRvdGFscyA9IHsndG90YWxkdicgICA6IHRvdGFsZHYsXG4gICAgICAgICAgICAgICAgICAgICAgICAgJ3RvdGFsbWFzcycgOiB0b3RhbE1hc3MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgJ3RvdGFscGFydHMnOiB0b3RhbFBhcnRzfTtcbiAgICB9XG4gICAgJHNjb3BlLm5ld1N0YWdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzdGFnZSA9IHt9O1xuICAgICAgICBzdGFnZS5hdG0gPSB0cnVlO1xuICAgICAgICBzdGFnZS5wYXJ0c0xpc3QgPSBbXTtcbiAgICAgICAgc3RhZ2UucmVzdWx0ID0geydpbXB1bHNlJyA6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAndGhydXN0cmF0aW8nIDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdkdicgOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3N1bXdldG1hc3MnIDogMH07XG4gICAgICAgIHN0YWdlLnJlbW92ZVBhcnQgPSBmdW5jdGlvbihwYXJ0aWQpIHtcbiAgICAgICAgICAgIHZhciBwYXJ0RXhpc3RzID0gcGFydGlkID4gLTFcbiAgICAgICAgICAgICAgICAmJiB0eXBlb2Ygc3RhZ2UucGFydHNMaXN0W3BhcnRpZF0gIT09ICd1bmRlZmluZWQnO1xuICAgICAgICAgICAgaWYgKHBhcnRFeGlzdHMpIHtcbiAgICAgICAgICAgICAgIHN0YWdlLnBhcnRzTGlzdC5zcGxpY2UocGFydGlkLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN0YWdlLnJlc3VsdCA9IHN0YWdlLmNhbGN1bGF0ZSgwKTtcbiAgICAgICAgfVxuICAgICAgICBzdGFnZS5hZGRQYXJ0ID0gZnVuY3Rpb24ocGFydCkge1xuICAgICAgICAgICAgdmFyIG5ld3BhcnQgPSB7J25hbWUnIDogcGFydC5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3dldG1hc3MnIDogcGFydC53ZXRtYXNzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RyeW1hc3MnIDogcGFydC5kcnltYXNzfTtcbiAgICAgICAgICAgIHZhciBwcm9wZXJ0aWVzID0gWydpbXB1bHNlYXRtJywgJ2ltcHVsc2V2YWMnLCAndGhydXN0YXRtJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0aHJ1c3R2YWMnXTtcblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wZXJ0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbmV3cGFydFtwcm9wZXJ0aWVzW2ldXSA9XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jaGVja1Byb3BlcnR5KHBhcnQsIHByb3BlcnRpZXNbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3RhZ2UucGFydHNMaXN0LnB1c2gobmV3cGFydCk7XG4gICAgICAgIH1cbiAgICAgICAgc3RhZ2UuY2FsY3VsYXRlID0gZnVuY3Rpb24ocGF5bG9hZE1hc3MpIHtcbiAgICAgICAgICAgIHZhciBzdW10aHJ1c3QsIHN1bWZ1ZWx1c2VkLCB0b3RhbGltcHVsc2UsIGR2LCBzdW13ZXRtYXNzLFxuICAgICAgICAgICAgICAgIHN1bWRyeW1hc3MsIHRocnVzdHJhdGlvO1xuICAgICAgICAgICAgc3VtdGhydXN0ID0gc3VtZnVlbHVzZWQgPSB0b3RhbGltcHVsc2UgPSBkdiA9IHRocnVzdHJhdGlvID0gMDtcbiAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gYWNjb3VudCBmb3IgdGhlIG1hc3Mgb2YgYWxsIHVwcGVyIHN0YWdlcy5cbiAgICAgICAgICAgIHN1bWRyeW1hc3MgPSBzdW13ZXRtYXNzID0gcGF5bG9hZE1hc3M7XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RhZ2UucGFydHNMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgc3VtZHJ5bWFzcyArPSBzdGFnZS5wYXJ0c0xpc3RbaV0uZHJ5bWFzcztcbiAgICAgICAgICAgICAgICBzdW13ZXRtYXNzICs9IHN0YWdlLnBhcnRzTGlzdFtpXS53ZXRtYXNzO1xuICAgICAgICAgICAgICAgIHZhciBpbXB1bHNlLCB0aHJ1c3Q7XG4gICAgICAgICAgICAgICAgaWYgKHN0YWdlLmF0bSkge1xuICAgICAgICAgICAgICAgICAgICBpbXB1bHNlID0gc3RhZ2UucGFydHNMaXN0W2ldLmltcHVsc2VhdG07XG4gICAgICAgICAgICAgICAgICAgIHRocnVzdCA9IHN0YWdlLnBhcnRzTGlzdFtpXS50aHJ1c3RhdG07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaW1wdWxzZSA9IHN0YWdlLnBhcnRzTGlzdFtpXS5pbXB1bHNldmFjO1xuICAgICAgICAgICAgICAgICAgICB0aHJ1c3QgPSBzdGFnZS5wYXJ0c0xpc3RbaV0udGhydXN0dmFjO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaW1wdWxzZSAhPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBzdW10aHJ1c3QgKz0gdGhydXN0O1xuICAgICAgICAgICAgICAgICAgICBzdW1mdWVsdXNlZCArPSB0aHJ1c3QgLyBpbXB1bHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdW1mdWVsdXNlZCAhPT0gMCkge1xuICAgICAgICAgICAgICAgIHRvdGFsaW1wdWxzZSA9IHN1bXRocnVzdCAvIHN1bWZ1ZWx1c2VkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHN1bWRyeW1hc3MgIT09IDApIHtcbiAgICAgICAgICAgICAgICBkdiA9IE1hdGgubG9nKHN1bXdldG1hc3MgLyBzdW1kcnltYXNzKVxuICAgICAgICAgICAgICAgICAgICAgKiAkc2NvcGUuZ3Jhdml0eSAqIHRvdGFsaW1wdWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdW13ZXRtYXNzICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhydXN0cmF0aW8gPSBzdW10aHJ1c3QgLyAoc3Vtd2V0bWFzcyAqICRzY29wZS5ncmF2aXR5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB7J2ltcHVsc2UnIDogdG90YWxpbXB1bHNlLFxuICAgICAgICAgICAgICAgICAgICAndGhydXN0cmF0aW8nIDogdGhydXN0cmF0aW8sXG4gICAgICAgICAgICAgICAgICAgICdkdicgOiBkdixcbiAgICAgICAgICAgICAgICAgICAgJ3N1bXdldG1hc3MnIDogc3Vtd2V0bWFzc307XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN0YWdlO1xuICAgIH1cbn1dKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
