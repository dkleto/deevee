"use strict";var deevee=angular.module("deeVee",[]);deevee.controller("stageCtrl",["$scope","$http",function(t,a){a.get("parts/parts.json").success(function(a){t.parts=a,t.hideCats()}),t.isPartDialogOpen=function(){return t.partDialog?"partDialogOpen":""},t.catSelected=function(a){return t.parts[a].visible?"selected":""},t.hideCats=function(){for(var a=0;a<t.parts.length;a++)t.parts[a].visible=!1},t.toggleCat=function(a){t.hideCats(),t.parts[a].visible=!t.parts[a].visible},t.partDialog=!1,t.currentStage=!1,t.openPartDialog=function(a){t.currentStage=a,t.partDialog=!0},t.closePartDialog=function(){t.partDialog=!1,t.currentStage=!1},t.savePartDialog=function(a,s){t.addStagePart(a,s),t.closePartDialog()},t.gravity=9.81,t.totals={totaldv:0,totalmass:0,totalparts:0},t.checkProperty=function(t,a){return"number"==typeof t[a]?t[a]:0},t.stageList=[],t.addStage=function(){t.stageList.push(t.newStage()),t.updateTotals()},t.removeStage=function(a){t.stageList.splice(a,1),t.stageList.length>0&&t.updateCalculations(a),t.updateTotals()},t.addStagePart=function(a,s){t.stageList[a].addPart(s),t.updateCalculations(a),t.updateTotals()},t.removeStagePart=function(a,s){t.stageList[a].removePart(s),t.updateCalculations(a),t.updateTotals()},t.updateCalculations=function(a){if(0===a)t.stageList[a].result=t.stageList[a].calculate(0),t.stageList.length>0&&t.updateCalculations(1);else for(var s=a;s<t.stageList.length;s++){var e=t.stageList[s-1].result.sumwetmass;t.stageList[s].result=t.stageList[s].calculate(e)}},t.updateTotals=function(){var a,s,e;a=s=e=0;for(var r=0;r<t.stageList.length;r++)s+=t.stageList[r].result.dv,e+=t.stageList[r].partsList.length,r===t.stageList.length-1&&(a=t.stageList[r].result.sumwetmass);t.totals={totaldv:s,totalmass:a,totalparts:e}},t.newStage=function(){var a={};return a.atm=!0,a.partsList=[],a.result={impulse:0,thrustratio:0,dv:0,sumwetmass:0},a.removePart=function(t){var s=t>-1&&"undefined"!=typeof a.partsList[t];s&&a.partsList.splice(t,1),a.result=a.calculate(0)},a.addPart=function(s){for(var e={name:s.name,wetmass:s.wetmass,drymass:s.drymass},r=["impulseatm","impulsevac","thrustatm","thrustvac"],i=0;i<r.length;i++)e[r[i]]=t.checkProperty(s,r[i]);a.partsList.push(e)},a.calculate=function(s){var e,r,i,l,u,n,o;e=r=i=l=o=0,n=u=s;for(var c=0;c<a.partsList.length;c++){n+=a.partsList[c].drymass,u+=a.partsList[c].wetmass;var g,p;a.atm?(g=a.partsList[c].impulseatm,p=a.partsList[c].thrustatm):(g=a.partsList[c].impulsevac,p=a.partsList[c].thrustvac),0!==g&&(e+=p,r+=p/g)}return 0!==r&&(i=e/r),0!==n&&(l=Math.log(u/n)*t.gravity*i),0!==u&&(o=e/(u*t.gravity)),{impulse:i,thrustratio:o,dv:l,sumwetmass:u}},a}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJkZWV2ZWUiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29udHJvbGxlciIsIiRzY29wZSIsIiRodHRwIiwiZ2V0Iiwic3VjY2VzcyIsImRhdGEiLCJwYXJ0cyIsImhpZGVDYXRzIiwiaXNQYXJ0RGlhbG9nT3BlbiIsInBhcnREaWFsb2ciLCJjYXRTZWxlY3RlZCIsImluZGV4IiwidmlzaWJsZSIsImkiLCJsZW5ndGgiLCJ0b2dnbGVDYXQiLCJjYXRJbmRleCIsImN1cnJlbnRTdGFnZSIsIm9wZW5QYXJ0RGlhbG9nIiwic3RhZ2VJbmRleCIsImNsb3NlUGFydERpYWxvZyIsInNhdmVQYXJ0RGlhbG9nIiwicGFydCIsImFkZFN0YWdlUGFydCIsImdyYXZpdHkiLCJ0b3RhbHMiLCJ0b3RhbGR2IiwidG90YWxtYXNzIiwidG90YWxwYXJ0cyIsImNoZWNrUHJvcGVydHkiLCJwcm9wZXJ0eSIsInN0YWdlTGlzdCIsImFkZFN0YWdlIiwicHVzaCIsIm5ld1N0YWdlIiwidXBkYXRlVG90YWxzIiwicmVtb3ZlU3RhZ2UiLCJzcGxpY2UiLCJ1cGRhdGVDYWxjdWxhdGlvbnMiLCJhZGRQYXJ0IiwicmVtb3ZlU3RhZ2VQYXJ0IiwicGFydGlkIiwicmVtb3ZlUGFydCIsInJlc3VsdCIsImNhbGN1bGF0ZSIsInByZXZSZXN1bHQiLCJ0b3RhbE1hc3MiLCJ0b3RhbFBhcnRzIiwiZHYiLCJwYXJ0c0xpc3QiLCJzdW13ZXRtYXNzIiwic3RhZ2UiLCJhdG0iLCJpbXB1bHNlIiwidGhydXN0cmF0aW8iLCJwYXJ0RXhpc3RzIiwibmV3cGFydCIsIm5hbWUiLCJ3ZXRtYXNzIiwiZHJ5bWFzcyIsInByb3BlcnRpZXMiLCJwYXlsb2FkTWFzcyIsInN1bXRocnVzdCIsInN1bWZ1ZWx1c2VkIiwidG90YWxpbXB1bHNlIiwic3VtZHJ5bWFzcyIsInRocnVzdCIsImltcHVsc2VhdG0iLCJ0aHJ1c3RhdG0iLCJpbXB1bHNldmFjIiwidGhydXN0dmFjIiwiTWF0aCIs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QVVwQyxHQUFHNkMsT0FDakMsSUFBSUwsR0FBU2EsQ0FDVGYsR0FBTUMsS0FDTkMsRUFBVUYsRUFBTUYsVUFBVXBDLEdBQUdzRCxXQUM3QkQsRUFBU2YsRUFBTUYsVUFBVXBDLEdBQUd1RCxZQUU1QmYsRUFBVUYsRUFBTUYsVUFBVXBDLEdBQUd3RCxXQUM3QkgsRUFBU2YsRUFBTUYsVUFBVXBDLEdBQUd5RCxXQUVoQixJQUFaakIsSUFDQVMsR0FBYUksRUFDYkgsR0FBZUcsRUFBU2IsR0FhaEMsTUFWb0IsS0FBaEJVLElBQ0FDLEVBQWVGLEVBQVlDLEdBRVosSUFBZkUsSUFDQWpCLEVBQUt1QixLQUFLQyxJQUFJdEIsRUFBYWUsR0FDcEJoRSxFQUFPdUIsUUFBVXdDLEdBRVQsSUFBZmQsSUFDQUksRUFBY1EsR0FBYVosRUFBYWpELEVBQU91QixXQUUzQzZCLFFBQVlXLEVBQ1pWLFlBQWdCQSxFQUNoQk4sR0FBT0EsRUFDUEUsV0FBZUEsSUFFcEJDIiwiZmlsZSI6ImFsbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbnZhciBkZWV2ZWUgPSBhbmd1bGFyLm1vZHVsZSgnZGVlVmVlJywgW10pO1xuXG5kZWV2ZWUuY29udHJvbGxlcignc3RhZ2VDdHJsJywgWyckc2NvcGUnLCAnJGh0dHAnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwKSB7XG4gICAgJGh0dHAuZ2V0KCdwYXJ0cy9wYXJ0cy5qc29uJykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAkc2NvcGUucGFydHMgPSBkYXRhO1xuICAgICAgJHNjb3BlLmhpZGVDYXRzKCk7XG4gICAgfSk7XG4gICAgJHNjb3BlLmlzUGFydERpYWxvZ09wZW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuICRzY29wZS5wYXJ0RGlhbG9nID8gJ3BhcnREaWFsb2dPcGVuJyA6ICcnO1xuICAgIH1cbiAgICAkc2NvcGUuY2F0U2VsZWN0ZWQgPSBmdW5jdGlvbihpbmRleCkge1xuICAgICAgICByZXR1cm4gJHNjb3BlLnBhcnRzW2luZGV4XS52aXNpYmxlID8gJ3NlbGVjdGVkJyA6ICcnO1xuICAgIH1cbiAgICAkc2NvcGUuaGlkZUNhdHMgPSBmdW5jdGlvbigpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgJHNjb3BlLnBhcnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgJHNjb3BlLnBhcnRzW2ldLnZpc2libGUgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgJHNjb3BlLnRvZ2dsZUNhdCA9IGZ1bmN0aW9uKGNhdEluZGV4KSB7XG4gICAgICAgICRzY29wZS5oaWRlQ2F0cygpO1xuICAgICAgICAkc2NvcGUucGFydHNbY2F0SW5kZXhdLnZpc2libGUgPSAhJHNjb3BlLnBhcnRzW2NhdEluZGV4XS52aXNpYmxlO1xuICAgIH1cbiAgICAkc2NvcGUucGFydERpYWxvZyA9IGZhbHNlO1xuICAgICRzY29wZS5jdXJyZW50U3RhZ2UgPSBmYWxzZTtcbiAgICAkc2NvcGUub3BlblBhcnREaWFsb2cgPSBmdW5jdGlvbihzdGFnZUluZGV4KSB7XG4gICAgICAgICRzY29wZS5jdXJyZW50U3RhZ2UgPSBzdGFnZUluZGV4O1xuICAgICAgICAkc2NvcGUucGFydERpYWxvZyA9IHRydWU7XG4gICAgfVxuICAgICRzY29wZS5jbG9zZVBhcnREaWFsb2cgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgJHNjb3BlLnBhcnREaWFsb2cgPSBmYWxzZTtcbiAgICAgICAgJHNjb3BlLmN1cnJlbnRTdGFnZSA9IGZhbHNlO1xuICAgIH1cbiAgICAkc2NvcGUuc2F2ZVBhcnREaWFsb2cgPSBmdW5jdGlvbihzdGFnZUluZGV4LCBwYXJ0KSB7XG4gICAgICAgICRzY29wZS5hZGRTdGFnZVBhcnQoc3RhZ2VJbmRleCwgcGFydCk7XG4gICAgICAgICRzY29wZS5jbG9zZVBhcnREaWFsb2coKTtcbiAgICB9XG4gICAgJHNjb3BlLmdyYXZpdHkgPSA5LjgxO1xuICAgICRzY29wZS50b3RhbHMgPSB7J3RvdGFsZHYnICAgOiAwLFxuICAgICAgICAgICAgICAgICAgICAgJ3RvdGFsbWFzcycgOiAwLFxuICAgICAgICAgICAgICAgICAgICAgJ3RvdGFscGFydHMnOiAwfTtcbiAgICAkc2NvcGUuY2hlY2tQcm9wZXJ0eSA9IGZ1bmN0aW9uKHBhcnQsIHByb3BlcnR5KSB7XG4gICAgICAgIC8vIElmIGEgcGFydCBkb2Vzbid0IGhhdmUgYW4gaW1wdWxzZSBvciB0aHJ1c3QgdmFsdWUsIGFzc3VtZSB6ZXJvLlxuICAgICAgICBpZiAodHlwZW9mIHBhcnRbcHJvcGVydHldID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgcmV0dXJuIHBhcnRbcHJvcGVydHldO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgJHNjb3BlLnN0YWdlTGlzdCA9IFtdO1xuICAgICRzY29wZS5hZGRTdGFnZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAkc2NvcGUuc3RhZ2VMaXN0LnB1c2goJHNjb3BlLm5ld1N0YWdlKCkpO1xuICAgICAgICAkc2NvcGUudXBkYXRlVG90YWxzKCk7XG4gICAgfVxuICAgICRzY29wZS5yZW1vdmVTdGFnZSA9IGZ1bmN0aW9uKHN0YWdlSW5kZXgpIHtcbiAgICAgICAgJHNjb3BlLnN0YWdlTGlzdC5zcGxpY2Uoc3RhZ2VJbmRleCwgMSk7XG4gICAgICAgIGlmICgkc2NvcGUuc3RhZ2VMaXN0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICRzY29wZS51cGRhdGVDYWxjdWxhdGlvbnMoc3RhZ2VJbmRleCk7XG4gICAgICAgIH1cbiAgICAgICAgJHNjb3BlLnVwZGF0ZVRvdGFscygpO1xuICAgIH1cbiAgICAkc2NvcGUuYWRkU3RhZ2VQYXJ0ID0gZnVuY3Rpb24oc3RhZ2VJbmRleCwgcGFydCkge1xuICAgICAgICAkc2NvcGUuc3RhZ2VMaXN0W3N0YWdlSW5kZXhdLmFkZFBhcnQocGFydCk7XG4gICAgICAgICRzY29wZS51cGRhdGVDYWxjdWxhdGlvbnMoc3RhZ2VJbmRleCk7XG4gICAgICAgICRzY29wZS51cGRhdGVUb3RhbHMoKTtcbiAgICB9XG4gICAgJHNjb3BlLnJlbW92ZVN0YWdlUGFydCA9IGZ1bmN0aW9uKHN0YWdlSW5kZXgsIHBhcnRpZCkge1xuICAgICAgICAkc2NvcGUuc3RhZ2VMaXN0W3N0YWdlSW5kZXhdLnJlbW92ZVBhcnQocGFydGlkKTtcbiAgICAgICAgJHNjb3BlLnVwZGF0ZUNhbGN1bGF0aW9ucyhzdGFnZUluZGV4KTtcbiAgICAgICAgJHNjb3BlLnVwZGF0ZVRvdGFscygpO1xuICAgIH1cbiAgICAkc2NvcGUudXBkYXRlQ2FsY3VsYXRpb25zID0gZnVuY3Rpb24oc3RhZ2VJbmRleCkge1xuICAgICAgICAvLyBUaGUgdXBwZXJtb3N0IHN0YWdlIGhhcyBubyBwYXlsb2FkIHRvIGZhY3RvciBpbi5cbiAgICAgICAgaWYgKHN0YWdlSW5kZXggPT09IDApIHtcbiAgICAgICAgICAgICRzY29wZS5zdGFnZUxpc3Rbc3RhZ2VJbmRleF0ucmVzdWx0ID1cbiAgICAgICAgICAgICAgICAkc2NvcGUuc3RhZ2VMaXN0W3N0YWdlSW5kZXhdLmNhbGN1bGF0ZSgwKTtcbiAgICAgICAgICAgIGlmICgkc2NvcGUuc3RhZ2VMaXN0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUudXBkYXRlQ2FsY3VsYXRpb25zKDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gUmVjYWxjdWxhdGUgYWxsIHN0YWdlcyBiZWxvdyB0aGlzIG9uZSBhcyB3ZWxsLlxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IHN0YWdlSW5kZXg7IGkgPCAkc2NvcGUuc3RhZ2VMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHByZXZSZXN1bHQgPSAkc2NvcGUuc3RhZ2VMaXN0W2kgLSAxXS5yZXN1bHRbJ3N1bXdldG1hc3MnXTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc3RhZ2VMaXN0W2ldLnJlc3VsdCA9XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zdGFnZUxpc3RbaV0uY2FsY3VsYXRlKHByZXZSZXN1bHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgICRzY29wZS51cGRhdGVUb3RhbHMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRvdGFsTWFzcywgdG90YWxkdiwgdG90YWxQYXJ0cztcbiAgICAgICAgdG90YWxNYXNzID0gdG90YWxkdiA9IHRvdGFsUGFydHMgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8ICRzY29wZS5zdGFnZUxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRvdGFsZHYgKz0gJHNjb3BlLnN0YWdlTGlzdFtpXS5yZXN1bHQuZHY7XG4gICAgICAgICAgICB0b3RhbFBhcnRzICs9ICRzY29wZS5zdGFnZUxpc3RbaV0ucGFydHNMaXN0Lmxlbmd0aDtcbiAgICAgICAgICAgIC8vIFVzZSB0aGUgdmFsdWUgb2YgdGhlIGxhc3Qgc3RhZ2UsIGFzIHN1bXdldG1hc3MgaXMgY3VtdWxhdGl2ZS5cbiAgICAgICAgICAgIGlmIChpID09PSAkc2NvcGUuc3RhZ2VMaXN0Lmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICB0b3RhbE1hc3MgPSAkc2NvcGUuc3RhZ2VMaXN0W2ldLnJlc3VsdC5zdW13ZXRtYXNzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgJHNjb3BlLnRvdGFscyA9IHsndG90YWxkdicgICA6IHRvdGFsZHYsXG4gICAgICAgICAgICAgICAgICAgICAgICAgJ3RvdGFsbWFzcycgOiB0b3RhbE1hc3MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgJ3RvdGFscGFydHMnOiB0b3RhbFBhcnRzfTtcbiAgICB9XG4gICAgJHNjb3BlLm5ld1N0YWdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzdGFnZSA9IHt9O1xuICAgICAgICBzdGFnZS5hdG0gPSB0cnVlO1xuICAgICAgICBzdGFnZS5wYXJ0c0xpc3QgPSBbXTtcbiAgICAgICAgc3RhZ2UucmVzdWx0ID0geydpbXB1bHNlJyA6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAndGhydXN0cmF0aW8nIDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdkdicgOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3N1bXdldG1hc3MnIDogMH07XG4gICAgICAgIHN0YWdlLnJlbW92ZVBhcnQgPSBmdW5jdGlvbihwYXJ0aWQpIHtcbiAgICAgICAgICAgIHZhciBwYXJ0RXhpc3RzID0gcGFydGlkID4gLTFcbiAgICAgICAgICAgICAgICAmJiB0eXBlb2Ygc3RhZ2UucGFydHNMaXN0W3BhcnRpZF0gIT09ICd1bmRlZmluZWQnO1xuICAgICAgICAgICAgaWYgKHBhcnRFeGlzdHMpIHtcbiAgICAgICAgICAgICAgIHN0YWdlLnBhcnRzTGlzdC5zcGxpY2UocGFydGlkLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN0YWdlLnJlc3VsdCA9IHN0YWdlLmNhbGN1bGF0ZSgwKTtcbiAgICAgICAgfVxuICAgICAgICBzdGFnZS5hZGRQYXJ0ID0gZnVuY3Rpb24ocGFydCkge1xuICAgICAgICAgICAgdmFyIG5ld3BhcnQgPSB7J25hbWUnIDogcGFydC5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3dldG1hc3MnIDogcGFydC53ZXRtYXNzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RyeW1hc3MnIDogcGFydC5kcnltYXNzfTtcbiAgICAgICAgICAgIHZhciBwcm9wZXJ0aWVzID0gWydpbXB1bHNlYXRtJywgJ2ltcHVsc2V2YWMnLCAndGhydXN0YXRtJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0aHJ1c3R2YWMnXTtcblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wZXJ0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbmV3cGFydFtwcm9wZXJ0aWVzW2ldXSA9XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jaGVja1Byb3BlcnR5KHBhcnQsIHByb3BlcnRpZXNbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3RhZ2UucGFydHNMaXN0LnB1c2gobmV3cGFydCk7XG4gICAgICAgIH1cbiAgICAgICAgc3RhZ2UuY2FsY3VsYXRlID0gZnVuY3Rpb24ocGF5bG9hZE1hc3MpIHtcbiAgICAgICAgICAgIHZhciBzdW10aHJ1c3QsIHN1bWZ1ZWx1c2VkLCB0b3RhbGltcHVsc2UsIGR2LCBzdW13ZXRtYXNzLFxuICAgICAgICAgICAgICAgIHN1bWRyeW1hc3MsIHRocnVzdHJhdGlvO1xuICAgICAgICAgICAgc3VtdGhydXN0ID0gc3VtZnVlbHVzZWQgPSB0b3RhbGltcHVsc2UgPSBkdiA9IHRocnVzdHJhdGlvID0gMDtcbiAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gYWNjb3VudCBmb3IgdGhlIG1hc3Mgb2YgYWxsIHVwcGVyIHN0YWdlcy5cbiAgICAgICAgICAgIHN1bWRyeW1hc3MgPSBzdW13ZXRtYXNzID0gcGF5bG9hZE1hc3M7XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RhZ2UucGFydHNMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgc3VtZHJ5bWFzcyArPSBzdGFnZS5wYXJ0c0xpc3RbaV0uZHJ5bWFzcztcbiAgICAgICAgICAgICAgICBzdW13ZXRtYXNzICs9IHN0YWdlLnBhcnRzTGlzdFtpXS53ZXRtYXNzO1xuICAgICAgICAgICAgICAgIHZhciBpbXB1bHNlLCB0aHJ1c3Q7XG4gICAgICAgICAgICAgICAgaWYgKHN0YWdlLmF0bSkge1xuICAgICAgICAgICAgICAgICAgICBpbXB1bHNlID0gc3RhZ2UucGFydHNMaXN0W2ldLmltcHVsc2VhdG07XG4gICAgICAgICAgICAgICAgICAgIHRocnVzdCA9IHN0YWdlLnBhcnRzTGlzdFtpXS50aHJ1c3RhdG07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaW1wdWxzZSA9IHN0YWdlLnBhcnRzTGlzdFtpXS5pbXB1bHNldmFjO1xuICAgICAgICAgICAgICAgICAgICB0aHJ1c3QgPSBzdGFnZS5wYXJ0c0xpc3RbaV0udGhydXN0dmFjO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoaW1wdWxzZSAhPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBzdW10aHJ1c3QgKz0gdGhydXN0O1xuICAgICAgICAgICAgICAgICAgICBzdW1mdWVsdXNlZCArPSB0aHJ1c3QgLyBpbXB1bHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdW1mdWVsdXNlZCAhPT0gMCkge1xuICAgICAgICAgICAgICAgIHRvdGFsaW1wdWxzZSA9IHN1bXRocnVzdCAvIHN1bWZ1ZWx1c2VkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHN1bWRyeW1hc3MgIT09IDApIHtcbiAgICAgICAgICAgICAgICBkdiA9IE1hdGgubG9nKHN1bXdldG1hc3MgLyBzdW1kcnltYXNzKVxuICAgICAgICAgICAgICAgICAgICAgKiAkc2NvcGUuZ3Jhdml0eSAqIHRvdGFsaW1wdWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdW13ZXRtYXNzICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhydXN0cmF0aW8gPSBzdW10aHJ1c3QgLyAoc3Vtd2V0bWFzcyAqICRzY29wZS5ncmF2aXR5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB7J2ltcHVsc2UnIDogdG90YWxpbXB1bHNlLFxuICAgICAgICAgICAgICAgICAgICAndGhydXN0cmF0aW8nIDogdGhydXN0cmF0aW8sXG4gICAgICAgICAgICAgICAgICAgICdkdicgOiBkdixcbiAgICAgICAgICAgICAgICAgICAgJ3N1bXdldG1hc3MnIDogc3Vtd2V0bWFzc307XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN0YWdlO1xuICAgIH1cbn1dKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
