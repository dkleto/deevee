"use strict";var deevee=angular.module("deeVee",[]);deevee.controller("stageCtrl",["$scope","$http",function(t,a){a.get("parts/parts.json").success(function(a){t.parts=a,t.hideCats()}),t.multiplier=1,t.multiClass=function(){return t.multiplier>1?"highlight-blue":""},t.incrementMultiplier=function(){t.multiplier>4?t.multiplier=1:t.multiplier++},t.isPartDialogOpen=function(){return t.partDialog?"partDialogOpen":""},t.catSelected=function(a){return t.parts[a].visible?"selected":""},t.hideCats=function(){for(var a=0;a<t.parts.length;a++)t.parts[a].visible=!1},t.toggleCat=function(a){t.hideCats(),t.parts[a].visible=!t.parts[a].visible},t.partDialog=!1,t.currentStage=!1,t.openPartDialog=function(a){t.currentStage=a,t.partDialog=!0},t.closePartDialog=function(){t.partDialog=!1,t.currentStage=!1},t.savePartDialog=function(a,s){t.addStagePart(a,s,t.multiplier),t.closePartDialog()},t.gravity=9.81,t.totals={totaldv:0,totalmass:0,totalparts:0},t.checkProperty=function(t,a){return"number"==typeof t[a]?t[a]:0},t.stageList=[],t.addStage=function(){t.stageList.push(t.newStage()),t.updateTotals()},t.removeStage=function(a){t.stageList.splice(a,1),t.stageList.length>0&&t.updateCalculations(a),t.updateTotals()},t.addStagePart=function(a,s,e){for(var r=0;e>r;r++)console.log("adding: "+s),t.stageList[a].addPart(s);t.updateCalculations(a),t.updateTotals()},t.removeStagePart=function(a,s){t.stageList[a].removePart(s),t.updateCalculations(a),t.updateTotals()},t.updateCalculations=function(a){if(0===a)t.stageList[a].result=t.stageList[a].calculate(0),t.stageList.length>0&&t.updateCalculations(1);else for(var s=a;s<t.stageList.length;s++){var e=t.stageList[s-1].result.sumwetmass;t.stageList[s].result=t.stageList[s].calculate(e)}},t.updateTotals=function(){var a,s,e;a=s=e=0;for(var r=0;r<t.stageList.length;r++)s+=t.stageList[r].result.dv,e+=t.stageList[r].partsList.length,r===t.stageList.length-1&&(a=t.stageList[r].result.sumwetmass);t.totals={totaldv:s,totalmass:a,totalparts:e}},t.newStage=function(){var a={};return a.atm=!0,a.partsList=[],a.result={impulse:0,thrustratio:0,dv:0,sumwetmass:0},a.removePart=function(t){var s=t>-1&&"undefined"!=typeof a.partsList[t];s&&a.partsList.splice(t,1),a.result=a.calculate(0)},a.addPart=function(s){for(var e={name:s.name,wetmass:s.wetmass,drymass:s.drymass},r=["impulseatm","impulsevac","thrustatm","thrustvac"],i=0;i<r.length;i++)e[r[i]]=t.checkProperty(s,r[i]);a.partsList.push(e)},a.calculate=function(s){var e,r,i,l,u,n,o;e=r=i=l=o=0,n=u=s;for(var p=0;p<a.partsList.length;p++){n+=a.partsList[p].drymass,u+=a.partsList[p].wetmass;var c,g;a.atm?(c=a.partsList[p].impulseatm,g=a.partsList[p].thrustatm):(c=a.partsList[p].impulsevac,g=a.partsList[p].thrustvac),0!==c&&(e+=g,r+=g/c)}return 0!==r&&(i=e/r),0!==n&&(l=Math.log(u/n)*t.gravity*i),0!==u&&(o=e/(u*t.gravity)),{impulse:i,thrustratio:o,dv:l,sumwetmass:u}},a}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJkZWV2ZWUiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29udHJvbGxlciIsIiRzY29wZSIsIiRodHRwIiwiZ2V0Iiwic3VjY2VzcyIsImRhdGEiLCJwYXJ0cyIsImhpZGVDYXRzIiwibXVsdGlwbGllciIsIm11bHRpQ2xhc3MiLCJpbmNyZW1lbnRNdWx0aXBsaWVyIiwiaXNQYXJ0RGlhbG9nT3BlbiIsInBhcnREaWFsb2ciLCJjYXRTZWxlY3RlZCIsImluZGV4IiwidmlzaWJsZSIsImkiLCJsZW5ndGgiLCJ0b2dnbGVDYXQiLCJjYXRJbmRleCIsImN1cnJlbnRTdGFnZSIsIm9wZW5QYXJ0RGlhbG9nIiwic3RhZ2VJbmRleCIsImNsb3NlUGFydERpYWxvZyIsInNhdmVQYXJ0RGlhbG9nIiwicGFydCIsImFkZFN0YWdlUGFydCIsImdyYXZpdHkiLCJ0b3RhbHMiLCJ0b3RhbGR2IiwidG90YWxtYXNzIiwidG90YWxwYXJ0cyIsImNoZWNrUHJvcGVydHkiLCJwcm9wZXJ0eSIsInN0YWdlTGlzdCIsImFkZFN0YWdlIiwicHVzaCIsIm5ld1N0YWdlIiwidXBkYXRlVG90YWxzIiwicmVtb3ZlU3RhZ2UiLCJzcGxpY2UiLCJ1cGRhdGVDYWxjdWxhdGlvbnMiLCJjb25zb2xlIiwibG9nIiwiYWRkUGFydCIsInJlbW92ZVN0YWdlUGFydCIsInBhcnRpZCIsInJlbW92ZVBhcnQiLCJyZXN1bHQiLCJjYWxjdWxhdGUiLCJwcmV2UmVzdWx0IiwidG90YWxNYXNzIiwidG90YWxQYXJ0cyIsImR2IiwicGFydHNMaXN0Iiwic3Vtd2V0bWFzcyIsInN0YWdlIiwiYXRtIiwiaW1wdWxzZSIsInRocnVzdHJhdGlvIiwicGFydEV4aXN0cyIsIm5ld3BhcnQiLCJuYW1lIiwid2V0bWFzcyIsImRyeW1hc3MiLCJwcm9wZXJ0aWVzIiwicGF5bG9hZE1hc3MiLCJzdW10aHJ1c3QiLCJzdW1mdWVsdXNlZCIsInRvdGFsaW1wdWxzZSIsInN1bWRyeW1hc3MiLCJ0aHJ1c3QiLCJpbXB1bHNlYXRtIiwidGhydXN0YXRtIiwiaW1wdWxzZXZhYyIsInRocnVzdHZhYyIsIk1hdGgiXSwibWFwcGluZ3MiOiJBQUFBLFlBRUEsSUFBSUEsUUFBU0MsUUFBUUMsT0FBTyxZQUU1QkYsUUFBT0csV0FBVyxhQUFjLFNBQVUsUUFBUyxTQUFTQyxFQUFRQyxHQUNoRUEsRUFBTUMsSUFBSSxvQkFBb0JDLFFBQVEsU0FBU0MsR0FDN0NKLEVBQU9LLE1BQVFELEVBQ2ZKLEVBQU9NLGFBRVROLEVBQU9PLFdBQWEsRUFDcEJQLEVBQU9RLFdBQWEsV0FDaEIsTUFBSVIsR0FBT08sV0FBYSxFQUNiLGlCQUVKLElBRVhQLEVBQU9TLG9CQUFzQixXQUNyQlQsRUFBT08sV0FBYSxFQUNwQlAsRUFBT08sV0FBYSxFQUVwQlAsRUFBT08sY0FHZlAsRUFBT1UsaUJBQW1CLFdBQ3RCLE1BQU9WLEdBQU9XLFdBQWEsaUJBQW1CLElBRWxEWCxFQUFPWSxZQUFjLFNBQVNDLEdBQzFCLE1BQU9iLEdBQU9LLE1BQU1RLEdBQU9DLFFBQVUsV0FBYSxJQUV0RGQsRUFBT00sU0FBVyxXQUNoQixJQUFLLEdBQUlTLEdBQUksRUFBR0EsRUFBSWYsRUFBT0ssTUFBTVcsT0FBUUQsSUFDckNmLEVBQU9LLE1BQU1VLEdBQUdELFNBQVUsR0FHaENkLEVBQU9pQixVQUFZLFNBQVNDLEdBQ3hCbEIsRUFBT00sV0FDUE4sRUFBT0ssTUFBTWEsR0FBVUosU0FBV2QsRUFBT0ssTUFBTWEsR0FBVUosU0FFN0RkLEVBQU9XLFlBQWEsRUFDcEJYLEVBQU9tQixjQUFlLEVBQ3RCbkIsRUFBT29CLGVBQWlCLFNBQVNDLEdBQzdCckIsRUFBT21CLGFBQWVFLEVBQ3RCckIsRUFBT1csWUFBYSxHQUV4QlgsRUFBT3NCLGdCQUFrQixXQUNyQnRCLEVBQU9XLFlBQWEsRUFDcEJYLEVBQU9tQixjQUFlLEdBRTFCbkIsRUFBT3VCLGVBQWlCLFNBQVNGLEVBQVlHLEdBQ3pDeEIsRUFBT3lCLGFBQWFKLEVBQVlHLEVBQU14QixFQUFPTyxZQUM3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TXdDLEVBQVdqRCxHQUU5Q3dDLEdBQU1GLFVBQVVsQixLQUFLeUIsSUFFekJMLEVBQU1QLFVBQVksU0FBU2lCLEdBQ3ZCLEdBQUlDLEdBQVdDLEVBQWFDLEVBQWNoQixFQUFJRSxFQUMxQ2UsRUFBWVgsQ0FDaEJRLEdBQVlDLEVBQWNDLEVBQWVoQixFQUFLTSxFQUFjLEVBRTVEVyxFQUFhZixFQUFhVyxDQUUxQixLQUFLLEdBQUlsRCxHQUFJLEVBQUdBLEVBQUl3QyxFQUFNRixVQUFVckMsT0FBUUQsSUFBSyxDQUM3Q3NELEdBQWNkLEVBQU1GLFVBQVV0QyxHQUFHZ0QsUUFDakNULEdBQWNDLEVBQU1GLFVBQVV0QyxHQUFHK0MsT0FDakMsSUFBSUwsR0FBU2EsQ0FDVGYsR0FBTUMsS0FDTkMsRUFBVUYsRUFBTUYsVUFBVXRDLEdBQUd3RCxXQUM3QkQsRUFBU2YsRUFBTUYsVUFBVXRDLEdBQUd5RCxZQUU1QmYsRUFBVUYsRUFBTUYsVUFBVXRDLEdBQUcwRCxXQUM3QkgsRUFBU2YsRUFBTUYsVUFBVXRDLEdBQUcyRCxXQUVoQixJQUFaakIsSUFDQVMsR0FBYUksRUFDYkgsR0FBZUcsRUFBU2IsR0FhaEMsTUFWb0IsS0FBaEJVLElBQ0FDLEVBQWVGLEVBQVlDLEdBRVosSUFBZkUsSUFDQWpCLEVBQUt1QixLQUFLakMsSUFBSVksRUFBYWUsR0FDcEJyRSxFQUFPMEIsUUFBVTBDLEdBRVQsSUFBZmQsSUFDQUksRUFBY1EsR0FBYVosRUFBYXRELEVBQU8wQixXQUUzQytCLFFBQVlXLEVBQ1pWLFlBQWdCQSxFQUNoQk4sR0FBT0EsRUFDUEUsV0FBZUEsSUFFcEJDIiwiZmlsZSI6ImFsbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbnZhciBkZWV2ZWUgPSBhbmd1bGFyLm1vZHVsZSgnZGVlVmVlJywgW10pO1xuXG5kZWV2ZWUuY29udHJvbGxlcignc3RhZ2VDdHJsJywgWyckc2NvcGUnLCAnJGh0dHAnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwKSB7XG4gICAgJGh0dHAuZ2V0KCdwYXJ0cy9wYXJ0cy5qc29uJykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAkc2NvcGUucGFydHMgPSBkYXRhO1xuICAgICAgJHNjb3BlLmhpZGVDYXRzKCk7XG4gICAgfSk7XG4gICAgJHNjb3BlLm11bHRpcGxpZXIgPSAxO1xuICAgICRzY29wZS5tdWx0aUNsYXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICgkc2NvcGUubXVsdGlwbGllciA+IDEpIHtcbiAgICAgICAgICAgIHJldHVybiAnaGlnaGxpZ2h0LWJsdWUnO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnJztcbiAgICB9XG4gICAgJHNjb3BlLmluY3JlbWVudE11bHRpcGxpZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCRzY29wZS5tdWx0aXBsaWVyID4gNCkge1xuICAgICAgICAgICAgJHNjb3BlLm11bHRpcGxpZXIgPSAxO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJHNjb3BlLm11bHRpcGxpZXIrKztcbiAgICAgICAgfVxuICAgIH1cbiAgICAkc2NvcGUuaXNQYXJ0RGlhbG9nT3BlbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gJHNjb3BlLnBhcnREaWFsb2cgPyAncGFydERpYWxvZ09wZW4nIDogJyc7XG4gICAgfVxuICAgICRzY29wZS5jYXRTZWxlY3RlZCA9IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICAgIHJldHVybiAkc2NvcGUucGFydHNbaW5kZXhdLnZpc2libGUgPyAnc2VsZWN0ZWQnIDogJyc7XG4gICAgfVxuICAgICRzY29wZS5oaWRlQ2F0cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkc2NvcGUucGFydHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAkc2NvcGUucGFydHNbaV0udmlzaWJsZSA9IGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICAkc2NvcGUudG9nZ2xlQ2F0ID0gZnVuY3Rpb24oY2F0SW5kZXgpIHtcbiAgICAgICAgJHNjb3BlLmhpZGVDYXRzKCk7XG4gICAgICAgICRzY29wZS5wYXJ0c1tjYXRJbmRleF0udmlzaWJsZSA9ICEkc2NvcGUucGFydHNbY2F0SW5kZXhdLnZpc2libGU7XG4gICAgfVxuICAgICRzY29wZS5wYXJ0RGlhbG9nID0gZmFsc2U7XG4gICAgJHNjb3BlLmN1cnJlbnRTdGFnZSA9IGZhbHNlO1xuICAgICRzY29wZS5vcGVuUGFydERpYWxvZyA9IGZ1bmN0aW9uKHN0YWdlSW5kZXgpIHtcbiAgICAgICAgJHNjb3BlLmN1cnJlbnRTdGFnZSA9IHN0YWdlSW5kZXg7XG4gICAgICAgICRzY29wZS5wYXJ0RGlhbG9nID0gdHJ1ZTtcbiAgICB9XG4gICAgJHNjb3BlLmNsb3NlUGFydERpYWxvZyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAkc2NvcGUucGFydERpYWxvZyA9IGZhbHNlO1xuICAgICAgICAkc2NvcGUuY3VycmVudFN0YWdlID0gZmFsc2U7XG4gICAgfVxuICAgICRzY29wZS5zYXZlUGFydERpYWxvZyA9IGZ1bmN0aW9uKHN0YWdlSW5kZXgsIHBhcnQpIHtcbiAgICAgICAgJHNjb3BlLmFkZFN0YWdlUGFydChzdGFnZUluZGV4LCBwYXJ0LCAkc2NvcGUubXVsdGlwbGllcik7XG4gICAgICAgICRzY29wZS5jbG9zZVBhcnREaWFsb2coKTtcbiAgICB9XG4gICAgJHNjb3BlLmdyYXZpdHkgPSA5LjgxO1xuICAgICRzY29wZS50b3RhbHMgPSB7J3RvdGFsZHYnICAgOiAwLFxuICAgICAgICAgICAgICAgICAgICAgJ3RvdGFsbWFzcycgOiAwLFxuICAgICAgICAgICAgICAgICAgICAgJ3RvdGFscGFydHMnOiAwfTtcbiAgICAkc2NvcGUuY2hlY2tQcm9wZXJ0eSA9IGZ1bmN0aW9uKHBhcnQsIHByb3BlcnR5KSB7XG4gICAgICAgIC8vIElmIGEgcGFydCBkb2Vzbid0IGhhdmUgYW4gaW1wdWxzZSBvciB0aHJ1c3QgdmFsdWUsIGFzc3VtZSB6ZXJvLlxuICAgICAgICBpZiAodHlwZW9mIHBhcnRbcHJvcGVydHldID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgcmV0dXJuIHBhcnRbcHJvcGVydHldO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgJHNjb3BlLnN0YWdlTGlzdCA9IFtdO1xuICAgICRzY29wZS5hZGRTdGFnZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAkc2NvcGUuc3RhZ2VMaXN0LnB1c2goJHNjb3BlLm5ld1N0YWdlKCkpO1xuICAgICAgICAkc2NvcGUudXBkYXRlVG90YWxzKCk7XG4gICAgfVxuICAgICRzY29wZS5yZW1vdmVTdGFnZSA9IGZ1bmN0aW9uKHN0YWdlSW5kZXgpIHtcbiAgICAgICAgJHNjb3BlLnN0YWdlTGlzdC5zcGxpY2Uoc3RhZ2VJbmRleCwgMSk7XG4gICAgICAgIGlmICgkc2NvcGUuc3RhZ2VMaXN0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICRzY29wZS51cGRhdGVDYWxjdWxhdGlvbnMoc3RhZ2VJbmRleCk7XG4gICAgICAgIH1cbiAgICAgICAgJHNjb3BlLnVwZGF0ZVRvdGFscygpO1xuICAgIH1cbiAgICAkc2NvcGUuYWRkU3RhZ2VQYXJ0ID0gZnVuY3Rpb24oc3RhZ2VJbmRleCwgcGFydCwgbXVsdGlwbGllcikge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG11bHRpcGxpZXI7IGkrKykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2FkZGluZzogJytwYXJ0KTtcbiAgICAgICAgICAgICRzY29wZS5zdGFnZUxpc3Rbc3RhZ2VJbmRleF0uYWRkUGFydChwYXJ0KTtcbiAgICAgICAgfVxuICAgICAgICAkc2NvcGUudXBkYXRlQ2FsY3VsYXRpb25zKHN0YWdlSW5kZXgpO1xuICAgICAgICAkc2NvcGUudXBkYXRlVG90YWxzKCk7XG4gICAgfVxuICAgICRzY29wZS5yZW1vdmVTdGFnZVBhcnQgPSBmdW5jdGlvbihzdGFnZUluZGV4LCBwYXJ0aWQpIHtcbiAgICAgICAgJHNjb3BlLnN0YWdlTGlzdFtzdGFnZUluZGV4XS5yZW1vdmVQYXJ0KHBhcnRpZCk7XG4gICAgICAgICRzY29wZS51cGRhdGVDYWxjdWxhdGlvbnMoc3RhZ2VJbmRleCk7XG4gICAgICAgICRzY29wZS51cGRhdGVUb3RhbHMoKTtcbiAgICB9XG4gICAgJHNjb3BlLnVwZGF0ZUNhbGN1bGF0aW9ucyA9IGZ1bmN0aW9uKHN0YWdlSW5kZXgpIHtcbiAgICAgICAgLy8gVGhlIHVwcGVybW9zdCBzdGFnZSBoYXMgbm8gcGF5bG9hZCB0byBmYWN0b3IgaW4uXG4gICAgICAgIGlmIChzdGFnZUluZGV4ID09PSAwKSB7XG4gICAgICAgICAgICAkc2NvcGUuc3RhZ2VMaXN0W3N0YWdlSW5kZXhdLnJlc3VsdCA9XG4gICAgICAgICAgICAgICAgJHNjb3BlLnN0YWdlTGlzdFtzdGFnZUluZGV4XS5jYWxjdWxhdGUoMCk7XG4gICAgICAgICAgICBpZiAoJHNjb3BlLnN0YWdlTGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnVwZGF0ZUNhbGN1bGF0aW9ucygxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIFJlY2FsY3VsYXRlIGFsbCBzdGFnZXMgYmVsb3cgdGhpcyBvbmUgYXMgd2VsbC5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFnZUluZGV4OyBpIDwgJHNjb3BlLnN0YWdlTGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBwcmV2UmVzdWx0ID0gJHNjb3BlLnN0YWdlTGlzdFtpIC0gMV0ucmVzdWx0WydzdW13ZXRtYXNzJ107XG4gICAgICAgICAgICAgICAgJHNjb3BlLnN0YWdlTGlzdFtpXS5yZXN1bHQgPVxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc3RhZ2VMaXN0W2ldLmNhbGN1bGF0ZShwcmV2UmVzdWx0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAkc2NvcGUudXBkYXRlVG90YWxzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0b3RhbE1hc3MsIHRvdGFsZHYsIHRvdGFsUGFydHM7XG4gICAgICAgIHRvdGFsTWFzcyA9IHRvdGFsZHYgPSB0b3RhbFBhcnRzID0gMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkc2NvcGUuc3RhZ2VMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0b3RhbGR2ICs9ICRzY29wZS5zdGFnZUxpc3RbaV0ucmVzdWx0LmR2O1xuICAgICAgICAgICAgdG90YWxQYXJ0cyArPSAkc2NvcGUuc3RhZ2VMaXN0W2ldLnBhcnRzTGlzdC5sZW5ndGg7XG4gICAgICAgICAgICAvLyBVc2UgdGhlIHZhbHVlIG9mIHRoZSBsYXN0IHN0YWdlLCBhcyBzdW13ZXRtYXNzIGlzIGN1bXVsYXRpdmUuXG4gICAgICAgICAgICBpZiAoaSA9PT0gJHNjb3BlLnN0YWdlTGlzdC5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgdG90YWxNYXNzID0gJHNjb3BlLnN0YWdlTGlzdFtpXS5yZXN1bHQuc3Vtd2V0bWFzcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgICRzY29wZS50b3RhbHMgPSB7J3RvdGFsZHYnICAgOiB0b3RhbGR2LFxuICAgICAgICAgICAgICAgICAgICAgICAgICd0b3RhbG1hc3MnIDogdG90YWxNYXNzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICd0b3RhbHBhcnRzJzogdG90YWxQYXJ0c307XG4gICAgfVxuICAgICRzY29wZS5uZXdTdGFnZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc3RhZ2UgPSB7fTtcbiAgICAgICAgc3RhZ2UuYXRtID0gdHJ1ZTtcbiAgICAgICAgc3RhZ2UucGFydHNMaXN0ID0gW107XG4gICAgICAgIHN0YWdlLnJlc3VsdCA9IHsnaW1wdWxzZScgOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3RocnVzdHJhdGlvJyA6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAnZHYnIDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdzdW13ZXRtYXNzJyA6IDB9O1xuICAgICAgICBzdGFnZS5yZW1vdmVQYXJ0ID0gZnVuY3Rpb24ocGFydGlkKSB7XG4gICAgICAgICAgICB2YXIgcGFydEV4aXN0cyA9IHBhcnRpZCA+IC0xXG4gICAgICAgICAgICAgICAgJiYgdHlwZW9mIHN0YWdlLnBhcnRzTGlzdFtwYXJ0aWRdICE9PSAndW5kZWZpbmVkJztcbiAgICAgICAgICAgIGlmIChwYXJ0RXhpc3RzKSB7XG4gICAgICAgICAgICAgICBzdGFnZS5wYXJ0c0xpc3Quc3BsaWNlKHBhcnRpZCwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzdGFnZS5yZXN1bHQgPSBzdGFnZS5jYWxjdWxhdGUoMCk7XG4gICAgICAgIH1cbiAgICAgICAgc3RhZ2UuYWRkUGFydCA9IGZ1bmN0aW9uKHBhcnQpIHtcbiAgICAgICAgICAgIHZhciBuZXdwYXJ0ID0geyduYW1lJyA6IHBhcnQubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICd3ZXRtYXNzJyA6IHBhcnQud2V0bWFzcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICdkcnltYXNzJyA6IHBhcnQuZHJ5bWFzc307XG4gICAgICAgICAgICB2YXIgcHJvcGVydGllcyA9IFsnaW1wdWxzZWF0bScsICdpbXB1bHNldmFjJywgJ3RocnVzdGF0bScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGhydXN0dmFjJ107XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcGVydGllcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIG5ld3BhcnRbcHJvcGVydGllc1tpXV0gPVxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2hlY2tQcm9wZXJ0eShwYXJ0LCBwcm9wZXJ0aWVzW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN0YWdlLnBhcnRzTGlzdC5wdXNoKG5ld3BhcnQpO1xuICAgICAgICB9XG4gICAgICAgIHN0YWdlLmNhbGN1bGF0ZSA9IGZ1bmN0aW9uKHBheWxvYWRNYXNzKSB7XG4gICAgICAgICAgICB2YXIgc3VtdGhydXN0LCBzdW1mdWVsdXNlZCwgdG90YWxpbXB1bHNlLCBkdiwgc3Vtd2V0bWFzcyxcbiAgICAgICAgICAgICAgICBzdW1kcnltYXNzLCB0aHJ1c3RyYXRpbztcbiAgICAgICAgICAgIHN1bXRocnVzdCA9IHN1bWZ1ZWx1c2VkID0gdG90YWxpbXB1bHNlID0gZHYgPSB0aHJ1c3RyYXRpbyA9IDA7XG4gICAgICAgICAgICAvLyBXZSBuZWVkIHRvIGFjY291bnQgZm9yIHRoZSBtYXNzIG9mIGFsbCB1cHBlciBzdGFnZXMuXG4gICAgICAgICAgICBzdW1kcnltYXNzID0gc3Vtd2V0bWFzcyA9IHBheWxvYWRNYXNzO1xuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0YWdlLnBhcnRzTGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHN1bWRyeW1hc3MgKz0gc3RhZ2UucGFydHNMaXN0W2ldLmRyeW1hc3M7XG4gICAgICAgICAgICAgICAgc3Vtd2V0bWFzcyArPSBzdGFnZS5wYXJ0c0xpc3RbaV0ud2V0bWFzcztcbiAgICAgICAgICAgICAgICB2YXIgaW1wdWxzZSwgdGhydXN0O1xuICAgICAgICAgICAgICAgIGlmIChzdGFnZS5hdG0pIHtcbiAgICAgICAgICAgICAgICAgICAgaW1wdWxzZSA9IHN0YWdlLnBhcnRzTGlzdFtpXS5pbXB1bHNlYXRtO1xuICAgICAgICAgICAgICAgICAgICB0aHJ1c3QgPSBzdGFnZS5wYXJ0c0xpc3RbaV0udGhydXN0YXRtO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGltcHVsc2UgPSBzdGFnZS5wYXJ0c0xpc3RbaV0uaW1wdWxzZXZhYztcbiAgICAgICAgICAgICAgICAgICAgdGhydXN0ID0gc3RhZ2UucGFydHNMaXN0W2ldLnRocnVzdHZhYztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGltcHVsc2UgIT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgc3VtdGhydXN0ICs9IHRocnVzdDtcbiAgICAgICAgICAgICAgICAgICAgc3VtZnVlbHVzZWQgKz0gdGhydXN0IC8gaW1wdWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc3VtZnVlbHVzZWQgIT09IDApIHtcbiAgICAgICAgICAgICAgICB0b3RhbGltcHVsc2UgPSBzdW10aHJ1c3QgLyBzdW1mdWVsdXNlZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdW1kcnltYXNzICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgZHYgPSBNYXRoLmxvZyhzdW13ZXRtYXNzIC8gc3VtZHJ5bWFzcylcbiAgICAgICAgICAgICAgICAgICAgICogJHNjb3BlLmdyYXZpdHkgKiB0b3RhbGltcHVsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc3Vtd2V0bWFzcyAhPT0gMCkge1xuICAgICAgICAgICAgICAgIHRocnVzdHJhdGlvID0gc3VtdGhydXN0IC8gKHN1bXdldG1hc3MgKiAkc2NvcGUuZ3Jhdml0eSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4geydpbXB1bHNlJyA6IHRvdGFsaW1wdWxzZSxcbiAgICAgICAgICAgICAgICAgICAgJ3RocnVzdHJhdGlvJyA6IHRocnVzdHJhdGlvLFxuICAgICAgICAgICAgICAgICAgICAnZHYnIDogZHYsXG4gICAgICAgICAgICAgICAgICAgICdzdW13ZXRtYXNzJyA6IHN1bXdldG1hc3N9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdGFnZTtcbiAgICB9XG59XSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
